mutate(BA_percent = (BA_m2_ha/BA_m2_ha_total)*100) %>%
select(-"BA_m2_ha_total")
my.sp.p.df <- LT_SP_BCNBA_ha[LT_SP_BCNBA_ha$plot_ID == my.plot.id, ][, c("plot_ID",
"inv_year",
"SP_code",
"BA_m2_ha", "BA_percent")]
my.sp.p.df
my.sp.p.df <- unique(LT_SP_BCNBA_ha[LT_SP_BCNBA_ha$plot_ID == my.plot.id, ][, c("plot_ID",
"inv_year",
"SP_code",
"BA_m2_ha", "BA_percent")])
my.sp.p.df
my.sp.p.df %>% left_join(., SP_names_com_ID_tapeS %>%
mutate(char_code_ger_lowcase = tolower(Chr_code_ger)) %>%
select(char_code_ger_lowcase, LH_NH),
by = c("SP_code" = "char_code_ger_lowcase"))
my.sp.p.df %>%
left_join(.,
SP_names_com_ID_tapeS %>%
mutate(char_code_ger_lowcase = tolower(Chr_code_ger)) %>%
select(char_code_ger_lowcase, LH_NH),
by = c("SP_code" = "char_code_ger_lowcase")) %>%
group_by(plot_ID, inv_year, LH_NH) %>%
summarize(BA-m2_ha = sum(BA_m2_ha))
my.sp.p.df %>%
left_join(.,
SP_names_com_ID_tapeS %>%
mutate(char_code_ger_lowcase = tolower(Chr_code_ger)) %>%
select(char_code_ger_lowcase, LH_NH),
by = c("SP_code" = "char_code_ger_lowcase")) %>%
group_by(plot_ID, inv_year, LH_NH) %>%
summarize(BA_m2_ha = sum(BA_m2_ha))
my.sp.p.df %>%
left_join(.,
SP_names_com_ID_tapeS %>%
mutate(char_code_ger_lowcase = tolower(Chr_code_ger)) %>%
select(char_code_ger_lowcase, LH_NH),
by = c("SP_code" = "char_code_ger_lowcase")) %>%
group_by(plot_ID, inv_year, LH_NH) %>%
summarize(BA_m2_ha = sum(BA_m2_ha),
BA_percent = sum(BA_percent))
# calcaulte the composition / ration of coniferous and broadaleafed trees per plot
my.BLCF.p.df <- my.sp.p.df %>%
left_join(.,
SP_names_com_ID_tapeS %>%
mutate(char_code_ger_lowcase = tolower(Chr_code_ger)) %>%
select(char_code_ger_lowcase, LH_NH),
by = c("SP_code" = "char_code_ger_lowcase")) %>%
group_by(plot_ID, inv_year, LH_NH) %>%
summarize(BA_m2_ha = sum(BA_m2_ha),
BA_percent = sum(BA_percent))
my.sp.p.df
my.sp.p.df <- unique(LT_SP_BCNBA_ha[LT_SP_BCNBA_ha$plot_ID == my.plot.id, ][, c("plot_ID",
"inv_year",
"SP_code",
"BA_m2_ha", "BA_percent")])%>%
left_join(.,
SP_names_com_ID_tapeS %>%
mutate(char_code_ger_lowcase = tolower(Chr_code_ger)) %>%
select(char_code_ger_lowcase, LH_NH),
by = c("SP_code" = "char_code_ger_lowcase"))
my.sp.p.df
# calcaulte the composition / ration of coniferous and broadaleafed trees per plot
my.BLCF.p.df <- my.sp.p.df %>%
group_by(plot_ID, inv_year, LH_NH) %>%
summarize(BA_m2_ha = sum(BA_m2_ha),
BA_percent = sum(BA_percent))
my.BLCF.p.df
my.sp.p.df %>%
left_join(., my.BLCF.p.df, by = c(plot_ID, inv_year))
my.sp.p.df %>%
left_join(., my.BLCF.p.df, by = c("plot_ID", "inv_year"))
my.sp.p.df %>%
left_join(., my.BLCF.p.df, by = c("plot_ID", "inv_year", "LH_NH"))
my.sp.p.df %>%
left_join(., my.BLCF.p.df, by = c("plot_ID", "inv_year", "LH_NH", "BA_percent"))
my.sp.p.df %>%
rename(BA_per_LHNH = BA_percent) %>%
select("plot_ID", "inv_year", "LH_NH","BA_per_LHNH" ) %>%
left_join(., my.BLCF.p.df, by = c("plot_ID", "inv_year", "LH_NH"))
LT_SP_BCNBA_ha$SP_code
SP_names_com_ID_tapeS$bot_name
my.sp.p.df <- unique(LT_SP_BCNBA_ha[LT_SP_BCNBA_ha$plot_ID == my.plot.id, ][, c("plot_ID",
"inv_year",
"SP_code",
"BA_m2_ha", "BA_percent")])%>%
left_join(.,
SP_names_com_ID_tapeS$bot_genus %>%
mutate(char_code_ger_lowcase = tolower(Chr_code_ger)) %>%
select(char_code_ger_lowcase, LH_NH),
by = c("SP_code" = "char_code_ger_lowcase"))
SP_names_com_ID_tapeS$bot_genus
# calcaulte the composition / ration of coniferous and broadaleafed trees per plot
my.BLCF.p.df <- my.sp.p.df %>%
group_by(plot_ID, inv_year, LH_NH) %>%
summarize(BA_m2_ha = sum(BA_m2_ha),
BA_percent = sum(BA_percent))
my.BLCF.p.df
my.sp.p.df %>%
rename(BA_per_LHNH = BA_percent) %>%
select("plot_ID", "inv_year", "LH_NH","BA_per_LHNH" ) %>%
left_join(., my.BLCF.p.df, by = c("plot_ID", "inv_year", "LH_NH")) %>%
mutate(besttype_SP_group = case_when(bot_genus == "Picea" ~ "FI",
bot_genus == "Pinus" ~ "KI",
!(bot_genus %in% c("Picea", "Pinus")) & LH_NH != "NB" ~ "aNH",
SP_code == "Fagus" ~ "BU",
SP_code == "Quercus" ~ "EI",
!(bot_genus %in% c("Fagus", "Quercus")) & LH_NH != "LB" ~ "aLH"))
# i = 1
my.plot.id <- unique(trees_data$plot_ID)[i]
my.sp.p.df <- unique(LT_SP_BCNBA_ha[LT_SP_BCNBA_ha$plot_ID == my.plot.id, ][, c("plot_ID",
"inv_year",
"SP_code",
"BA_m2_ha", "BA_percent")])%>%
left_join(.,
SP_names_com_ID_tapeS %>%
mutate(char_code_ger_lowcase = tolower(Chr_code_ger)) %>%
select(char_code_ger_lowcase, LH_NH, bot_genus),
by = c("SP_code" = "char_code_ger_lowcase"))
# calcaulte the composition / ration of coniferous and broadaleafed trees per plot
my.BLCF.p.df <- my.sp.p.df %>%
group_by(plot_ID, inv_year, LH_NH) %>%
summarize(BA_m2_ha = sum(BA_m2_ha),
BA_percent = sum(BA_percent))
my.sp.p.df %>%
rename(BA_per_LHNH = BA_percent) %>%
select("plot_ID", "inv_year", "LH_NH","BA_per_LHNH" ) %>%
left_join(., my.BLCF.p.df, by = c("plot_ID", "inv_year", "LH_NH")) %>%
mutate(besttype_SP_group = case_when(bot_genus == "Picea" ~ "FI",
bot_genus == "Pinus" ~ "KI",
!(bot_genus %in% c("Picea", "Pinus")) & LH_NH != "NB" ~ "aNH",
SP_code == "Fagus" ~ "BU",
SP_code == "Quercus" ~ "EI",
!(bot_genus %in% c("Fagus", "Quercus")) & LH_NH != "LB" ~ "aLH"))
my.sp.p.df %>%
rename(BA_per_LHNH = BA_percent) %>%
select("plot_ID", "inv_year", "LH_NH","BA_per_LHNH" ) %>%
left_join(., my.BLCF.p.df, by = c("plot_ID", "inv_year", "LH_NH")) %>%
mutate(besttype_SP_group = case_when(bot_genus == "Picea" ~ "FI",
bot_genus == "Pinus" ~ "KI",
!(bot_genus %in% c("Picea", "Pinus")) & LH_NH != "NB" ~ "aNH",
bot_genus == "Fagus" ~ "BU",
bot_genus == "Quercus" ~ "EI",
!(bot_genus %in% c("Fagus", "Quercus")) & LH_NH != "LB" ~ "aLH"))
my.sp.p.df %>%
left_join(., my.BLCF.p.df %>%
rename(BA_per_LHNH = BA_percent) %>%
select("plot_ID", "inv_year", "LH_NH","BA_per_LHNH" ),
by = c("plot_ID", "inv_year", "LH_NH"))
my.sp.p.df %>%
left_join(., my.BLCF.p.df %>%
rename(BA_per_LHNH = BA_percent) %>%
select("plot_ID", "inv_year", "LH_NH","BA_per_LHNH" ),
by = c("plot_ID", "inv_year", "LH_NH")) %>%
mutate(besttype_SP_group = case_when(bot_genus == "Picea" ~ "FI",
bot_genus == "Pinus" ~ "KI",
!(bot_genus %in% c("Picea", "Pinus")) & LH_NH != "NB" ~ "aNH",
bot_genus == "Fagus" ~ "BU",
bot_genus == "Quercus" ~ "EI",
!(bot_genus %in% c("Fagus", "Quercus")) & LH_NH != "LB" ~ "aLH"))
my.sp.p.df %>%
mutate(besttype_SP_group = case_when(bot_genus == "Picea" ~ "FI",
bot_genus == "Pinus" ~ "KI",
!(bot_genus %in% c("Picea", "Pinus")) & LH_NH == "NB" ~ "aNH",
bot_genus == "Fagus" ~ "BU",
bot_genus == "Quercus" ~ "EI",
!(bot_genus %in% c("Fagus", "Quercus")) & LH_NH == "LB" ~ "aLH",
TRUE ~ NA))
my.sp.p.df %>%
mutate(besttype_SP_group = case_when(bot_genus == "Picea" ~ "FI",
bot_genus == "Pinus" ~ "KI",
!(bot_genus %in% c("Picea", "Pinus")) & LH_NH == "NB" ~ "aNH",
bot_genus == "Fagus" ~ "BU",
bot_genus == "Quercus" ~ "EI",
!(bot_genus %in% c("Fagus", "Quercus")) & LH_NH == "LB" ~ "aLH",
TRUE ~ NA)) %>%
group_by(plot_ID,  inv_year, besttype_SP_group) %>%
summarise(BA_percent = sum(BA_percent))
my.sp.p.df %>%
mutate(besttype_SP_group = case_when(bot_genus == "Picea" ~ "FI",
bot_genus == "Pinus" ~ "KI",
!(bot_genus %in% c("Picea", "Pinus")) & LH_NH == "NB" ~ "aNH",
bot_genus == "Fagus" ~ "BU",
bot_genus == "Quercus" ~ "EI",
!(bot_genus %in% c("Fagus", "Quercus")) & LH_NH == "LB" ~ "aLH",
TRUE ~ NA)) %>%
group_by(plot_ID,  inv_year, besttype_SP_group, LH_NH) %>%
summarise(BA_percent = sum(BA_percent)) %>%
left_join(., my.BLCF.p.df %>%
rename(BA_per_LHNH = BA_percent) %>%
select("plot_ID", "inv_year", "LH_NH","BA_per_LHNH" ),
by = c("plot_ID", "inv_year", "LH_NH"))
my.sp.p.df %>%
mutate(besttype_SP_group = case_when(bot_genus == "Picea" ~ "FI",
bot_genus == "Pinus" ~ "KI",
!(bot_genus %in% c("Picea", "Pinus")) & LH_NH == "NB" ~ "aNH",
bot_genus == "Fagus" ~ "BU",
bot_genus == "Quercus" ~ "EI",
!(bot_genus %in% c("Fagus", "Quercus")) & LH_NH == "LB" ~ "aLH",
TRUE ~ NA)) %>%
group_by(plot_ID,  inv_year, besttype_SP_group, LH_NH) %>%
summarise(BA_percent = sum(BA_percent)) %>%
left_join(.,  my.sp.p.df %>%
group_by(plot_ID, inv_year, LH_NH) %>%
summarize(BA_m2_ha = sum(BA_m2_ha),
BA_per_LHNH = sum(BA_percent)) %>%
select("plot_ID", "inv_year", "LH_NH","BA_per_LHNH" ),
by = c("plot_ID", "inv_year", "LH_NH"))
LT_SP_BCNBA_ha %>% filter(compartiment == "ag") %>%
select(plot_ID, inv_year, SP_code, compartiment, BA_m2_ha) %>%
left_join(., LT_BCNBA_ha %>%
filter(compartiment == "ag") %>%
select(plot_ID, inv_year, BA_m2_ha) %>%
rename(BA_m2_ha_total = BA_m2_ha),
by = c("plot_ID", "inv_year"), ) %>%
distinct() %>%
mutate(BA_percent = (BA_m2_ha/BA_m2_ha_total)*100) %>%
select(-c("BA_m2_ha", "BA_m2_ha_total"))
LT_SP_BCNBA_ha %>% filter(compartiment == "ag") %>%
select(plot_ID, inv_year, SP_code, compartiment, BA_m2_ha) %>%
left_join(., LT_BCNBA_ha %>%
filter(compartiment == "ag") %>%
select(plot_ID, inv_year, BA_m2_ha) %>%
rename(BA_m2_ha_total = BA_m2_ha),
by = c("plot_ID", "inv_year"), ) %>%
distinct() %>%
mutate(BA_percent = (BA_m2_ha/BA_m2_ha_total)*100) %>%
select(-c("BA_m2_ha", "BA_m2_ha_total")) %>%
# now we try to introduce the stand type tpp
mutate(besttype_SP_group = case_when(bot_genus == "Picea" ~ "FI",
bot_genus == "Pinus" ~ "KI",
!(bot_genus %in% c("Picea", "Pinus")) & LH_NH == "NB" ~ "aNH",
bot_genus == "Fagus" ~ "BU",
bot_genus == "Quercus" ~ "EI",
!(bot_genus %in% c("Fagus", "Quercus")) & LH_NH == "LB" ~ "aLH",
TRUE ~ NA)) %>%
group_by(plot_ID,  inv_year, besttype_SP_group, LH_NH) %>%
summarise(BA_percent = sum(BA_percent))
LT_SP_BCNBA_ha %>% filter(compartiment == "ag") %>%
select(plot_ID, inv_year, SP_code, compartiment, BA_m2_ha) %>%
left_join(., LT_BCNBA_ha %>%
filter(compartiment == "ag") %>%
select(plot_ID, inv_year, BA_m2_ha) %>%
rename(BA_m2_ha_total = BA_m2_ha),
by = c("plot_ID", "inv_year"), ) %>%
distinct() %>%
mutate(BA_percent = (BA_m2_ha/BA_m2_ha_total)*100) %>%
select(-c("BA_m2_ha", "BA_m2_ha_total")) %>%
# now we try to introduce the stand type tpp
left_join(.,
SP_names_com_ID_tapeS %>%
mutate(char_code_ger_lowcase = tolower(Chr_code_ger)) %>%
select(char_code_ger_lowcase, LH_NH, bot_genus),
by = c("SP_code" = "char_code_ger_lowcase"))  %>%
mutate(besttype_SP_group = case_when(bot_genus == "Picea" ~ "FI",
bot_genus == "Pinus" ~ "KI",
!(bot_genus %in% c("Picea", "Pinus")) & LH_NH == "NB" ~ "aNH",
bot_genus == "Fagus" ~ "BU",
bot_genus == "Quercus" ~ "EI",
!(bot_genus %in% c("Fagus", "Quercus")) & LH_NH == "LB" ~ "aLH",
TRUE ~ NA)) %>%
group_by(plot_ID,  inv_year, besttype_SP_group, LH_NH) %>%
summarise(BA_percent = sum(BA_percent))
LT_SP_BCNBA_ha %>% filter(compartiment == "ag") %>%
select(plot_ID, inv_year, SP_code, BA_percent)
LT_SP_BCNBA_ha %>% filter(compartiment == "ag") %>%
select(plot_ID, inv_year, SP_code, BA_percent) %>%
distinct()
# now we try to introduce the stand type tpp
left_join(.,
SP_names_com_ID_tapeS %>%
mutate(char_code_ger_lowcase = tolower(Chr_code_ger)) %>%
select(char_code_ger_lowcase, LH_NH, bot_genus),
by = c("SP_code" = "char_code_ger_lowcase"))  %>%
mutate(besttype_SP_group = case_when(bot_genus == "Picea" ~ "FI",
bot_genus == "Pinus" ~ "KI",
!(bot_genus %in% c("Picea", "Pinus")) & LH_NH == "NB" ~ "aNH",
bot_genus == "Fagus" ~ "BU",
bot_genus == "Quercus" ~ "EI",
!(bot_genus %in% c("Fagus", "Quercus")) & LH_NH == "LB" ~ "aLH",
TRUE ~ NA)) %>%
group_by(plot_ID,  inv_year, besttype_SP_group, LH_NH) %>%
summarise(BA_percent = sum(BA_percent))
LT_SP_BCNBA_ha %>% filter(compartiment == "ag") %>%
select(plot_ID, inv_year, SP_code, BA_percent) %>%
distinct() %>%
# now we try to introduce the stand type tpp
left_join(.,
SP_names_com_ID_tapeS %>%
mutate(char_code_ger_lowcase = tolower(Chr_code_ger)) %>%
select(char_code_ger_lowcase, LH_NH, bot_genus),
by = c("SP_code" = "char_code_ger_lowcase"))  %>%
mutate(besttype_SP_group = case_when(bot_genus == "Picea" ~ "FI",
bot_genus == "Pinus" ~ "KI",
!(bot_genus %in% c("Picea", "Pinus")) & LH_NH == "NB" ~ "aNH",
bot_genus == "Fagus" ~ "BU",
bot_genus == "Quercus" ~ "EI",
!(bot_genus %in% c("Fagus", "Quercus")) & LH_NH == "LB" ~ "aLH",
TRUE ~ NA)) %>%
group_by(plot_ID,  inv_year, besttype_SP_group, LH_NH) %>%
summarise(BA_percent = sum(BA_percent))
LT_SP_BCNBA_ha %>% filter(compartiment == "ag") %>%
select(plot_ID, inv_year, SP_code, BA_percent) %>%
distinct() %>%
# now we try to introduce the stand type tpp
left_join(.,
SP_names_com_ID_tapeS %>%
mutate(char_code_ger_lowcase = tolower(Chr_code_ger)) %>%
select(char_code_ger_lowcase, LH_NH, bot_genus),
by = c("SP_code" = "char_code_ger_lowcase"))  %>%
mutate(besttype_SP_group = case_when(bot_genus == "Picea" ~ "FI",
bot_genus == "Pinus" ~ "KI",
!(bot_genus %in% c("Picea", "Pinus")) & LH_NH == "NB" ~ "aNH",
bot_genus == "Fagus" ~ "BU",
bot_genus == "Quercus" ~ "EI",
!(bot_genus %in% c("Fagus", "Quercus")) & LH_NH == "LB" ~ "aLH",
TRUE ~ NA)) %>%
group_by(plot_ID,  inv_year, besttype_SP_group, LH_NH) %>%
summarise(BA_percent = sum(BA_percent))
my.sp.p.df %>%
mutate(besttype_SP_group = case_when(bot_genus == "Picea" ~ "FI",
bot_genus == "Pinus" ~ "KI",
!(bot_genus %in% c("Picea", "Pinus")) & LH_NH == "NB" ~ "aNH",
bot_genus == "Fagus" ~ "BU",
bot_genus == "Quercus" ~ "EI",
!(bot_genus %in% c("Fagus", "Quercus")) & LH_NH == "LB" ~ "aLH",
TRUE ~ NA)) %>%
group_by(plot_ID,  inv_year, besttype_SP_group, LH_NH) %>%
summarise(BA_percent = sum(BA_percent)) %>%
left_join(.,  my.sp.p.df %>%
group_by(plot_ID, inv_year, LH_NH) %>%
summarize(BA_m2_ha = sum(BA_m2_ha),
BA_per_LHNH = sum(BA_percent)) %>%
select("plot_ID", "inv_year", "LH_NH","BA_per_LHNH" ),
by = c("plot_ID", "inv_year", "LH_NH"))
my.best.TY.p.df %>%
mutate(besttype_SP_group = case_when(bot_genus == "Picea" ~ "FI",
bot_genus == "Pinus" ~ "KI",
!(bot_genus %in% c("Picea", "Pinus")) & LH_NH == "NB" ~ "aNH",
bot_genus == "Fagus" ~ "BU",
bot_genus == "Quercus" ~ "EI",
!(bot_genus %in% c("Fagus", "Quercus")) & LH_NH == "LB" ~ "aLH",
TRUE ~ NA)) %>%
group_by(plot_ID,  inv_year, besttype_SP_group, LH_NH) %>%
summarise(BA_percent = sum(BA_percent))
y.best.TY.p.df <- my.sp.p.df %>%
mutate(besttype_SP_group = case_when(bot_genus == "Picea" ~ "FI",
bot_genus == "Pinus" ~ "KI",
!(bot_genus %in% c("Picea", "Pinus")) & LH_NH == "NB" ~ "aNH",
bot_genus == "Fagus" ~ "BU",
bot_genus == "Quercus" ~ "EI",
!(bot_genus %in% c("Fagus", "Quercus")) & LH_NH == "LB" ~ "aLH",
TRUE ~ NA)) %>%
group_by(plot_ID,  inv_year, besttype_SP_group, LH_NH) %>%
summarise(BA_percent = sum(BA_percent))
my.best.TY.p.df <- my.sp.p.df %>%
mutate(besttype_SP_group = case_when(bot_genus == "Picea" ~ "FI",
bot_genus == "Pinus" ~ "KI",
!(bot_genus %in% c("Picea", "Pinus")) & LH_NH == "NB" ~ "aNH",
bot_genus == "Fagus" ~ "BU",
bot_genus == "Quercus" ~ "EI",
!(bot_genus %in% c("Fagus", "Quercus")) & LH_NH == "LB" ~ "aLH",
TRUE ~ NA)) %>%
group_by(plot_ID,  inv_year, besttype_SP_group, LH_NH) %>%
summarise(BA_percent = sum(BA_percent))
my.best.TY.p.df
my.best.TY.p.df <- my.sp.p.df %>%
mutate(besttype_SP_group = case_when(bot_genus == "Picea" ~ "FI",
bot_genus == "Pinus" ~ "KI",
!(bot_genus %in% c("Picea", "Pinus")) & LH_NH == "NB" ~ "aNH",
bot_genus == "Fagus" ~ "BU",
bot_genus == "Quercus" ~ "EI",
!(bot_genus %in% c("Fagus", "Quercus")) & LH_NH == "LB" ~ "aLH",
TRUE ~ NA)) %>%
group_by(plot_ID,  inv_year, besttype_SP_group) %>%
summarise(BA_percent = sum(BA_percent))
my.best.TY.p.df
my.best.TY.p.df <- my.sp.p.df %>%
mutate(besttype_SP_group = case_when(bot_genus == "Picea" ~ "FI",
bot_genus == "Pinus" ~ "KI",
!(bot_genus %in% c("Picea", "Pinus")) & LH_NH == "NB" ~ "aNH",
bot_genus == "Fagus" ~ "BU",
bot_genus == "Quercus" ~ "EI",
!(bot_genus %in% c("Fagus", "Quercus")) & LH_NH == "LB" ~ "aLH",
TRUE ~ NA)) %>%
group_by(plot_ID,  inv_year, besttype_SP_group, LH_NH) %>%
summarise(BA_percent = sum(BA_percent))
my.sp.p.df %>%
mutate(besttype_SP_group = case_when(bot_genus == "Picea" ~ "FI",
bot_genus == "Pinus" ~ "KI",
!(bot_genus %in% c("Picea", "Pinus")) & LH_NH == "NB" ~ "aNH",
bot_genus == "Fagus" ~ "BU",
bot_genus == "Quercus" ~ "EI",
!(bot_genus %in% c("Fagus", "Quercus")) & LH_NH == "LB" ~ "aLH",
TRUE ~ NA)) %>%
group_by(plot_ID,  inv_year, besttype_SP_group, LH_NH) %>%
summarise(BA_percent = sum(BA_percent)) %>%
left_join(.,  my.sp.p.df %>%
group_by(plot_ID, inv_year, LH_NH) %>%
summarize(BA_m2_ha = sum(BA_m2_ha),
BA_per_LHNH = sum(BA_percent)) %>%
select("plot_ID", "inv_year", "LH_NH","BA_per_LHNH" ),
by = c("plot_ID", "inv_year", "LH_NH"))
my.sp.p.df %>%
mutate(besttype_SP_group = case_when(bot_genus == "Picea" ~ "FI",
bot_genus == "Pinus" ~ "KI",
!(bot_genus %in% c("Picea", "Pinus")) & LH_NH == "NB" ~ "aNH",
bot_genus == "Fagus" ~ "BU",
bot_genus == "Quercus" ~ "EI",
!(bot_genus %in% c("Fagus", "Quercus")) & LH_NH == "LB" ~ "aLH",
TRUE ~ NA)) %>%
group_by(plot_ID,  inv_year, besttype_SP_group, LH_NH) %>%
summarise(BA_percent = sum(BA_percent)) %>%
left_join(.,  my.sp.p.df %>%
group_by(plot_ID, inv_year, LH_NH) %>%
summarize(BA_m2_ha = sum(BA_m2_ha),
BA_per_LHNH = sum(BA_percent)) %>%
select("plot_ID", "inv_year", "LH_NH","BA_per_LHNH" ),
by = c("plot_ID", "inv_year", "LH_NH"))
mutate(besttype = ifelse(case_when(besttype_SP_group == "FI" & BA_percent >= 70 ~ "Fi-Rein" ,
besttype_SP_group == "KI" & BA_percent >= 70 ~ "Ki-Rein",
besttype_SP_group == "aNH" & BA_percent >= 70 ~ "sonst-Nd",
besttype_SP_group == "BU" & BA_percent >= 70 ~ "Bu-Rein" ,
besttype_SP_group == "EI" & BA_percent >= 70 ~ "Ei-Rein",
besttype_SP_group == "aLH" & BA_percent >= 70 ~ "sonst-Ld",
besttype_SP_group %in% c("BU", "EI", "aLH") & BA_percent < 70 &
LH_NH == "LB" & BA_per_LHNH >30 ~ "Nd-Ld-Misch",
besttype_SP_group %in% c("FI", "KI", "aNH") & BA_percent < 70 &
LH_NH == "NB" & BA_per_LHNH >30 ~ "Lb-Nd-Misch",
besttype_SP_group %in% c("FI", "KI", "aNH") & BA_percent < 70 &
LH_NH == "LB" & BA_per_LHNH < 30 ~ "Nb-Lb<30",
besttype_SP_group %in% c("BU", "EI", "aLH") & BA_percent < 70 &
LH_NH == "NB" & BA_per_LHNH >30 ~ "Lb-NB<30",
TRUE ~ NA)))
my.sp.p.df %>%
mutate(besttype_SP_group = case_when(bot_genus == "Picea" ~ "FI",
bot_genus == "Pinus" ~ "KI",
!(bot_genus %in% c("Picea", "Pinus")) & LH_NH == "NB" ~ "aNH",
bot_genus == "Fagus" ~ "BU",
bot_genus == "Quercus" ~ "EI",
!(bot_genus %in% c("Fagus", "Quercus")) & LH_NH == "LB" ~ "aLH",
TRUE ~ NA)) %>%
group_by(plot_ID,  inv_year, besttype_SP_group, LH_NH) %>%
summarise(BA_percent = sum(BA_percent)) %>%
left_join(.,  my.sp.p.df %>%
group_by(plot_ID, inv_year, LH_NH) %>%
summarize(BA_m2_ha = sum(BA_m2_ha),
BA_per_LHNH = sum(BA_percent)) %>%
select("plot_ID", "inv_year", "LH_NH","BA_per_LHNH" ),
by = c("plot_ID", "inv_year", "LH_NH"))
my.sp.p.df %>%
mutate(besttype_SP_group = case_when(bot_genus == "Picea" ~ "FI",
bot_genus == "Pinus" ~ "KI",
!(bot_genus %in% c("Picea", "Pinus")) & LH_NH == "NB" ~ "aNH",
bot_genus == "Fagus" ~ "BU",
bot_genus == "Quercus" ~ "EI",
!(bot_genus %in% c("Fagus", "Quercus")) & LH_NH == "LB" ~ "aLH",
TRUE ~ NA)) %>%
group_by(plot_ID,  inv_year, besttype_SP_group, LH_NH) %>%
summarise(BA_percent = sum(BA_percent)) %>%
left_join(.,  my.sp.p.df %>%
group_by(plot_ID, inv_year, LH_NH) %>%
summarize(BA_m2_ha = sum(BA_m2_ha),
BA_per_LHNH = sum(BA_percent)) %>%
select("plot_ID", "inv_year", "LH_NH","BA_per_LHNH" ),
by = c("plot_ID", "inv_year", "LH_NH")) %>%
mutate(besttype = ifelse(case_when(besttype_SP_group == "FI" & BA_percent >= 70 ~ "Fi-Rein" ,
besttype_SP_group == "KI" & BA_percent >= 70 ~ "Ki-Rein",
besttype_SP_group == "aNH" & BA_percent >= 70 ~ "sonst-Nd",
besttype_SP_group == "BU" & BA_percent >= 70 ~ "Bu-Rein" ,
besttype_SP_group == "EI" & BA_percent >= 70 ~ "Ei-Rein",
besttype_SP_group == "aLH" & BA_percent >= 70 ~ "sonst-Ld",
besttype_SP_group %in% c("BU", "EI", "aLH") & BA_percent < 70 &
LH_NH == "LB" & BA_per_LHNH >30 ~ "Nd-Ld-Misch",
besttype_SP_group %in% c("FI", "KI", "aNH") & BA_percent < 70 &
LH_NH == "NB" & BA_per_LHNH >30 ~ "Lb-Nd-Misch",
besttype_SP_group %in% c("FI", "KI", "aNH") & BA_percent < 70 &
LH_NH == "LB" & BA_per_LHNH < 30 ~ "Nb-Lb<30",
besttype_SP_group %in% c("BU", "EI", "aLH") & BA_percent < 70 &
LH_NH == "NB" & BA_per_LHNH >30 ~ "Lb-NB<30",
TRUE ~ NA)))
my.sp.p.df %>%
mutate(besttype_SP_group = case_when(bot_genus == "Picea" ~ "FI",
bot_genus == "Pinus" ~ "KI",
!(bot_genus %in% c("Picea", "Pinus")) & LH_NH == "NB" ~ "aNH",
bot_genus == "Fagus" ~ "BU",
bot_genus == "Quercus" ~ "EI",
!(bot_genus %in% c("Fagus", "Quercus")) & LH_NH == "LB" ~ "aLH",
TRUE ~ NA)) %>%
group_by(plot_ID,  inv_year, besttype_SP_group, LH_NH) %>%
summarise(BA_percent = sum(BA_percent)) %>%
left_join(.,  my.sp.p.df %>%
group_by(plot_ID, inv_year, LH_NH) %>%
summarize(BA_m2_ha = sum(BA_m2_ha),
BA_per_LHNH = sum(BA_percent)) %>%
select("plot_ID", "inv_year", "LH_NH","BA_per_LHNH" ),
by = c("plot_ID", "inv_year", "LH_NH")) %>%
mutate(besttype = (case_when(besttype_SP_group == "FI" & BA_percent >= 70 ~ "Fi-Rein" ,
besttype_SP_group == "KI" & BA_percent >= 70 ~ "Ki-Rein",
besttype_SP_group == "aNH" & BA_percent >= 70 ~ "sonst-Nd",
besttype_SP_group == "BU" & BA_percent >= 70 ~ "Bu-Rein" ,
besttype_SP_group == "EI" & BA_percent >= 70 ~ "Ei-Rein",
besttype_SP_group == "aLH" & BA_percent >= 70 ~ "sonst-Ld",
besttype_SP_group %in% c("BU", "EI", "aLH") & BA_percent < 70 &
LH_NH == "LB" & BA_per_LHNH >30 ~ "Nd-Ld-Misch",
besttype_SP_group %in% c("FI", "KI", "aNH") & BA_percent < 70 &
LH_NH == "NB" & BA_per_LHNH >30 ~ "Lb-Nd-Misch",
besttype_SP_group %in% c("FI", "KI", "aNH") & BA_percent < 70 &
LH_NH == "LB" & BA_per_LHNH < 30 ~ "Nb-Lb<30",
besttype_SP_group %in% c("BU", "EI", "aLH") & BA_percent < 70 &
LH_NH == "NB" & BA_per_LHNH >30 ~ "Lb-NB<30",
TRUE ~ NA)))

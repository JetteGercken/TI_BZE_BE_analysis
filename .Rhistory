# here we have to correct the remaining circle: the circle can only be the part that contains the center of the plot
inter.poly.5.1 <- if(nrow(st_intersection(inter.poly.5.1.a, circle.pt))==0){inter.poly.5.1.a}else{remaining.circle.5.1.a}
remaining.circle.5.1 <- if(nrow(st_intersection(remaining.circle.5.1.a, circle.pt))!=0){remaining.circle.5.1.a}else{inter.poly.5.1.a}
# print(plot(remaining.circle.12.1$geometry, main = paste0(my.plot.id, "-", my.e.form.2,  "-", c.r2)))
## create polygone of intersecting area of second polygone with remaining circle
inter.poly.5.2 <- st_intersection(my.poly.2, st_geometry(remaining.circle.5.1))
inter.status.poly.5.2 <- ifelse(nrow(inter.poly.5.2) == 0, "no intersections",
ifelse(my.e.form.2== 1 & inter.poly.5.2$geometry == remaining.circle.5.1$geometry,  "no intersections",
ifelse(my.e.form.2 == 2 & inter.poly.5.2$geometry == remaining.circle.5.1$geometry, "fully covering circle",
"partly intersecting")))
# if the second edge covers all of the circle remaining its going to be set to 0 so we know there are no direct intersections
# https://www.statology.org/r-argument-is-of-length-zero/
inter.poly.5.2 <- if(isTRUE(inter.poly.5.2) && inter.poly.5.2$geometry == remaining.circle.5.1$geometry){inter.poly.5.2 <- data.frame()}else{inter.poly.5.2}
## create polygone of the  remaining cricle after both intersects are decucted
# so the area of the frst remining circle minus the area of the second remaining circle
remaining.circle.5.1.and.2.poly <- if(nrow(inter.poly.5.2)==0){remaining.circle.5.1}else{sf::st_difference(remaining.circle.5.1, inter.poly.5.2)}
#### calculate the area
## 17m cricle
# area of the intersection 1
inter.17.1.area <- ifelse(nrow(inter.poly.17.1) == 0, 0, sf::st_area(inter.poly.17.1))
# area of the intersection polygone 2
inter.17.2.area <- ifelse(nrow(inter.poly.17.2) == 0, 0, sf::st_area(inter.poly.17.2))
#  area of the remaining circle, after both intersections are deducted
remaining.circle.area.17 <- sf::st_area(remaining.circle.17.1.and.2.poly)
# save area in dataframe
inter.area.df.17 <- as.data.frame(
cbind("plot_ID" = c(my.plot.id, my.plot.id, my.plot.id), "e_ID" = c(my.e.id.1, my.e.id.2, 0),
"inv_year" = c(my.inv.year, my.inv.year, my.inv.year),
#"e_form" = c(my.poly.1$e_form, my.poly.2$e_form, 0),"shape" = c("edge", "edge", "circle"),
"CCS_r_m" = c(c.r3, c.r3, c.r3),
"inter_stat" = c(inter.status.poly.17.1, inter.status.poly.17.2, 0),
"area_m2" = c(inter.17.1.area, inter.17.2.area, remaining.circle.area.17)
))
## 12m cricle
# area of the intersection 1
inter.12.1.area <- ifelse(nrow(inter.poly.12.1) == 0, 0, sf::st_area(inter.poly.12.1))
# area of the intersection polygone 2
inter.12.2.area <- ifelse(nrow(inter.poly.12.2) == 0, 0, sf::st_area(inter.poly.12.2))
#  area of the remaining circle, after both intersections are deducted
remaining.circle.area.12 <- sf::st_area(remaining.circle.12.1.and.2.poly)
# save area in dataframe
inter.area.df.12 <- as.data.frame(
cbind("plot_ID" = c(my.plot.id, my.plot.id, my.plot.id), "e_ID" = c(my.e.id.1, my.e.id.2, 0),
#"e_form" = c(my.poly.1$e_form, my.poly.2$e_form, 0),"shape" = c("edge", "edge", "circle"),
"inv_year" = c(my.inv.year, my.inv.year, my.inv.year),
"CCS_r_m" = c(c.r2, c.r2, c.r2),
"inter_stat" = c(inter.status.poly.12.1, inter.status.poly.12.2, 0),
"area_m2" = c(inter.12.1.area, inter.12.2.area, remaining.circle.area.12)
))
## 5m cricle
# area of the intersection 1
inter.5.1.area <- ifelse(nrow(inter.poly.5.1) == 0, 0, sf::st_area(inter.poly.5.1))
# area of the intersection polygone 2
inter.5.2.area <- ifelse(nrow(inter.poly.5.2) == 0, 0, sf::st_area(inter.poly.5.2))
#  area of the remaining circle, after both intersections are deducted
remaining.circle.area.5 <- sf::st_area(remaining.circle.5.1.and.2.poly)
# save area in dataframe
inter.area.df.5 <- as.data.frame(
cbind("plot_ID" = c(my.plot.id, my.plot.id, my.plot.id),
"e_ID" = c(my.e.id.1, my.e.id.2, 0),
#"e_form" = c(my.poly.1$e_form, my.poly.2$e_form, 0),"shape" = c("edge", "edge", "circle"),
"inv_year" = c(my.inv.year, my.inv.year, my.inv.year),
"CCS_r_m" = c(c.r1, c.r1, c.r1),
"inter_stat" = c(inter.status.poly.5.1, inter.status.poly.5.2, 0),
"area_m2" = c(inter.5.1.area, inter.5.2.area, remaining.circle.area.5)
))
# bind area datafames of all 3 circles together
inter.area.df <- rbind(inter.area.df.17, inter.area.df.12,inter.area.df.5 ) %>%
mutate(across(c("plot_ID", "e_ID", "inv_year", "CCS_r_m", "area_m2"), as.numeric))
# assing stand to the edges depedning on area and the stand with trees
# is there a polygone that does not incluce the middle of the plot, has the t<pe 1 or 2 (if its an edge) and doesn´t have trees
# then the poylgone is labelled with "no forest" and the remaining polygones are allocated into stands by area
# first "if": both edges are edge type 1 or 2 and do not have trees and do not have the middle of the plot
if(isTRUE(nrow(st_intersection(inter.poly.17.1, tree.sf))!=0 & my.poly.1$e_type %in% c(1,2))){inter.17.1.tree.stat <- "trees but outer edge"}else{inter.17.1.tree.stat <- NA}
if(isTRUE(nrow(st_intersection(inter.poly.17.2, tree.sf))!=0 & my.poly.2$e_type %in% c(1,2))){inter.17.2.tree.stat <- "trees but outer edge"}else{inter.17.2.tree.stat <- NA}
if(isTRUE(nrow(st_intersection(inter.poly.17.1, circle.pt))!=0 & my.poly.1$e_type %in% c(1,2))){inter.17.1.center.stat <- "center but outer edge"}else{inter.17.1.center.stat <- NA}
if(isTRUE(nrow(st_intersection(inter.poly.17.2, circle.pt))!=0 & my.poly.2$e_type %in% c(1,2))){inter.17.2.center.stat <- "center but outer edge"}else{inter.17.2.center.stat <- NA}
if(isTRUE(nrow(st_intersection(inter.poly.17.1, tree.sf))==0 & nrow(st_intersection(inter.poly.17.1, circle.pt))==0 & my.poly.1$e_type %in% c(1,2))){inter.17.1.forest.stat <- "no forest"}else{inter.17.1.forest.stat <- NA}
if(isTRUE(nrow(st_intersection(inter.poly.17.2, tree.sf))==0 & nrow(st_intersection(inter.poly.17.2, circle.pt))==0 & my.poly.2$e_type %in% c(1,2))){inter.17.2.forest.stat <- "no forest"}else{inter.17.2.forest.stat <- NA}
my.poly.1$stand <- case_when(inter.17.1.tree.stat ==  "trees but outer edge" | inter.17.1.center.stat == "center but outer edge" ~ "warning",
inter.17.1.tree.stat ==  "trees but outer edge" & inter.17.1.center.stat == "center but outer edge" ~ "warning",
inter.17.1.forest.stat == "no forest"~ "no forest",
TRUE ~ NA)
my.poly.2$stand <- case_when(inter.17.2.tree.stat ==  "trees but outer edge" | inter.17.2.center.stat == "center but outer edge" ~ "warning",
inter.17.2.tree.stat ==  "trees but outer edge" | inter.17.2.center.stat == "center but outer edge" ~ "warning",
inter.17.2.forest.stat == "no forest"~ "no forest",
TRUE ~ NA)
# create dataframe with stand info per edge/ remaining circle
stand.df <- as.data.frame(cbind(
"plot_ID" = my.plot.id,
"e_ID" = c(my.poly.1$e_ID, my.poly.2$e_ID, 0),
"stand"= c(ifelse(length(my.poly.1$stand) == 0, NA, my.poly.1$stand),
ifelse(length(my.poly.2$stand) == 0, NA, my.poly.2$stand),
ifelse(length(remaining.circle.17.1.and.2.poly$stand) == 0, NA, remaining.circle.17.1.and.2.poly$stand) ))) %>%
mutate(plot_ID = as.numeric(plot_ID),
e_ID = as.numeric(e_ID))
stand.df <-
rbind(
inter.area.df%>%
filter(CCS_r_m  == 17.84) %>%
mutate(area_m2 = as.numeric(area_m2)) %>%
left_join(., stand.df, by = c("plot_ID", "e_ID")) %>%
group_by(plot_ID, inv_year) %>%
arrange(desc(area_m2)) %>%
filter(!(stand %in% c("no forest", "warning"))) %>%
# assing stand according to row number by selecting the letter of the alphabet with the respective number e.g. row == 1 --> A:
# https://www.geeksforgeeks.org/sequence-of-alphabetical-character-letters-from-a-z-in-r/
# lowest area receives stand ID C, then B, then A
mutate(stand = LETTERS[row_number()]),
# dataset with "no forest" or "warning" stands (if there are any, if not i´ll just not bind them)
inter.area.df%>%
filter(CCS_r_m  == 17.84) %>%
mutate(area_m2 = as.numeric(area_m2)) %>%
left_join(., stand.df, by = c("plot_ID", "e_ID")) %>%
filter(stand %in% c("no forest", "warning")) %>%
mutate(stand = as.character(stand))
) %>%
# make stand.df joinable by only leaving plot_ID, e_ID, no matter the diameter of the CCS
select(- c(CCS_r_m, inter_stat, area_m2))
stand.df <- stand.df %>%
mutate(plot_ID = as.numeric(plot_ID),
e_ID = as.numeric(e_ID),
inv_year = as.numeric(inv_year))
# join in stand info based on area of the edge segment
inter.area.df <- inter.area.df %>% left_join(., stand.df,
by = c("plot_ID", "e_ID", "inv_year"))
print(  c(plot(circle.17$geometry, main = paste0(my.plot.id, " - ", my.e.form.1, " - ", my.e.form.2)),
plot(remaining.circle.17.1.and.2.poly$geometry, col = "grey", add = T),
plot(remaining.circle.12.1.and.2.poly$geometry, add = T),
plot(remaining.circle.5.1.and.2.poly$geometry, add = T),
plot(inter.poly.17.1$geometry, col = "green", add =TRUE),
plot(inter.poly.17.2$geometry, col = "blue", add =TRUE),
plot(circle.pt$geometry, col = "red",  add = TRUE),
legend("topleft", legend=c(paste0(unique(inter.area.df$stand[inter.area.df$e_ID == my.poly.1$e_ID]),":",  my.poly.1$e_type),
paste0(unique(inter.area.df$stand[inter.area.df$e_ID == my.poly.2$e_ID]),":",  my.poly.2$e_type),
paste0(unique(inter.area.df$stand[inter.area.df$e_ID == 0]),":","rem_circle")),
col=c("green", "blue", "grey"), lty=1:2, cex=0.8),
plot(st_geometry(tree.sf), add = TRUE)))
# save datacframe per plot in list
outer.edges.list.two.edges.nogeo[[i]] <- inter.area.df
# create list with those plot ID where the two edges intersect within the radius of 17.84m
intersection.between.edges.17 <- sf::st_intersection(
sf::st_intersection(my.poly.1, circle.17), # intersection poly 1 and cirlce 17
sf::st_intersection(my.poly.2, circle.17)) # intersection poly 2 and cirlce 17
intersection.warning.edges <- ifelse(nrow(intersection.between.edges.17) == 0, NA, intersection.between.edges.17$plot_ID)
outer.intersection.warning.edges.list.nogeo[[i]] <- as.data.frame(cbind("plot_ID" = c(intersection.warning.edges)))
## save intersection polygones in list
# poly.1
outer.inter.poly.1.list.nogeo[[i]] <- if(nrow(inter.poly.17.1)!= 0){c(inter.poly.17.1)}else{
# this is in case one of the inter polys is empty but we still want to transport the stand info with the polygone
c(my.poly.1)[1:6]}
# poly.2
outer.inter.poly.2.list.nogeo[[i]] <- if(nrow(inter.poly.17.2)!= 0){c(inter.poly.17.2)}else{
# this is in case one of the inter polys is empty but we still want to transport the stand info with the polygone
c(my.poly.2)[1:6]}
## save the reimaingf circle polygones in a list
remaining.circle.17.1.and.2.poly$plot_ID <- my.plot.id
remaining.circle.17.1.and.2.poly$e_ID <- 0
remaining.circle.17.1.and.2.poly$inv_year <- my.inv.year
remaining.circle.17.1.and.2.poly$e_form <- 0
remaining.circle.17.1.and.2.poly$geometry <- remaining.circle.17.1.and.2.poly$geometry
# create list wit polygones of the remaining cirlce when it´s only one polygone
outer.rem.circle.poly.2.edges.list.nogeo[[i]] <- if(st_geometry_type(remaining.circle.17.1.and.2.poly)== "POLYGON"){c(remaining.circle.17.1.and.2.poly)}else{}
# create list wit polygones of the remaining cirlce when it´s a multipoligone
outer.rem.circle.multipoly.2.edges.list.nogeo[[i]] <- if(st_geometry_type(remaining.circle.17.1.and.2.poly)== "MULTIPOLYGON"){c(remaining.circle.17.1.and.2.poly)}else{}
}
# save areas into dataframe
outer.edges.area.two.edges.df.nogeo <- as.data.frame(rbindlist(outer.edges.list.two.edges.nogeo))
# save plot IDs with overlappig edges within the 17.84m circle into dataframe
outer.intersection.two.edges.warning.df.nogeo <- na.omit(as.data.frame(rbindlist(outer.intersection.warning.edges.list.nogeo, fill=TRUE)))
if(nrow(outer.intersection.two.edges.warning.df.nogeo)!=0){print("There are plots with overlapping edges within a 17.84m radius around the plot center.
Please check dataset intersection.two.edges.warning.df.nogeo")}
# save intersection polygones into dataframe
# list of polygones 1 of forest edges
outer.inter.poly.1.two.edges.df.nogeo <- as.data.frame(rbindlist(outer.inter.poly.1.list.nogeo, fill=TRUE))
# list of polygones 2 of forest edges
outer.inter.poly.2.two.edges.df.nogeo <- as.data.frame(rbindlist(outer.inter.poly.2.list.nogeo, fill=TRUE))
# bind the both edges per plot together
outer.inter.poly.two.edges.df.nogeo <- plyr::rbind.fill(outer.inter.poly.1.two.edges.df.nogeo, outer.inter.poly.2.two.edges.df.nogeo)
# list of polygones of remainign circles
outer.rem.circle.poly.two.edges.list.final.nogeo <- rbindlist(outer.rem.circle.poly.2.edges.list.nogeo, fill = TRUE)
outer.rem.circle.poly.two.edges.df.nogeo <- as.data.frame(outer.rem.circle.poly.two.edges.list.final.nogeo)[,c("plot_ID", "inv_year","e_ID",  "e_form","geometry")]  %>% distinct()
# list of multipolygones of remaining circles
outer.rem.circle.multipoly.two.edges.df.nogeo <- if(nrow(as.data.frame(rbindlist(outer.rem.circle.multipoly.2.edges.list.nogeo)))!= 0){
as.data.frame(rbindlist(outer.rem.circle.multipoly.2.edges.list.nogeo, fill = TRUE))[,c("plot_ID", "inv_year","e_ID",  "e_form","geometry")] %>% distinct()
}else{  data.frame()}
# binding the both circle lists back together
outer.rem.circle.two.edges.df.nogeo <- if(isTRUE(nrow(outer.rem.circle.poly.two.edges.df.nogeo) != 0 && nrow(outer.rem.circle.multipoly.two.edges.df.nogeo) != 0) == T){
plyr::rbind.fill(outer.rem.circle.poly.two.edges.df.nogeo, outer.rem.circle.multipoly.two.edges.df.nogeo)
}else{outer.rem.circle.poly.two.edges.df.nogeo}
# bind all edges area dataframes together
all.edges.area.df.nogeo <- plyr::rbind.fill(edges.area.df.nogeo, edges.area.two.edges.df.nogeo, outer.edges.area.df.nogeo, outer.edges.area.two.edges.df.nogeo) %>% mutate(area_m2 = as.numeric(area_m2)) %>% filter(!is.na(plot_ID))
inter.poly.one.edge.df.nogeo <- plyr::rbind.fill(inter.poly.one.edge.df.nogeo, outer.inter.poly.one.edge.df.nogeo) # %>% select(colnames(inter.poly.one.edge.df.nogeo)))
rem.circle.one.edge.df.nogeo <- plyr::rbind.fill(rem.circle.one.edge.df.nogeo, outer.rem.circle.one.edge.df.nogeo) # %>% select(colnames(rem.circle.one.edge.df.nogeo)))
# 3.2.2. sorting TREES into edge and remaining circle polygones ---------
# 3.2.2.1. plots with one edge: sorting trees into edge and remaining circle polygones ---------
trees.one.edge.nogeo <- trees_data %>%
# filter only for trees that are located in plots with a forest edge
semi_join(forest_edges.man %>% filter(e_form == 1 | e_form == 2 & inter_status_AT_17 == "two I" | e_form == 2 & inter_status_BT_17 == "two I") %>%
select(plot_ID) %>% distinct(), by = "plot_ID") %>%
# filter for trees located in plots htat haev only one forest edge
anti_join(forest_edges.man %>% filter(e_form == 1 | e_form == 2 & inter_status_AT_17 == "two I" | e_form == 2 & inter_status_BT_17 == "two I") %>%
group_by(plot_ID) %>% summarise(n = n()) %>% filter(n > 1) %>% select(plot_ID), by = "plot_ID") #%>%
tree.status.list.nogeo <- vector("list", length = length(trees.one.edge.nogeo$tree_ID))
tree.points.list.nogeo <- vector("list", length = length(trees.one.edge.nogeo$tree_ID))
i = which(grepl(140042, (trees.one.edge.nogeo$plot_ID)))
i
i = 356
# select plot ID accordint to positioin in the list
my.plot.id <-trees.one.edge.nogeo [i, "plot_ID"]
my.tree.id <- trees.one.edge.nogeo[i, "tree_ID"]
my.inv.year <- trees.one.edge.nogeo[i, "inv_year"]
my.plot.id
my.tree.id
# select the remaining cirlce we want to intersect the tree with
my.rem.circle <- sf::st_as_sf(rem.circle.one.edge.df.nogeo %>% filter(plot_ID == my.plot.id) %>% distinct())
my.inter <- sf::st_as_sf(inter.poly.one.edge.df.nogeo  %>% filter(plot_ID == my.plot.id) %>% distinct())
area.plot.df <- all.edges.area.df.nogeo %>% filter(plot_ID == my.plot.id & CCS_r_m == 17.84)
# assign stand category to the polygones depending on which one is bigger/ smaller
my.rem.circle$stand <- area.plot.df$stand[area.plot.df$e_ID == 0]
my.inter$stand <- area.plot.df$stand[area.plot.df$e_ID == 1 | area.plot.df$e_ID == 2]
# extract polar coordiantes of forest edge
# point A
dist.tree <- trees.one.edge.nogeo[i, "dist_cm"]/100
azi.tree <- trees.one.edge.nogeo[i, "azi_gon"]
x.tree <- dist.tree*sin(azi.tree*pi/200)   # longitude, easting, RW, X
y.tree <- dist.tree*cos(azi.tree*pi/200)   # latitude, northing, HW, y
# transform polar into cartesian coordiantes
tree.east <- x.tree   # + my.center.easting
tree.north <-  y.tree # + my.center.northing
# save cartesian coordiantes in dataframe
tree.coord.df <- as.data.frame(cbind(
"plot_ID" = c(as.integer(my.plot.id)),
"tree_ID" = c(as.integer(my.tree.id)),
"inv_year" = c(my.inv.year),
"lon" = c(tree.east),
"lat" = c(tree.north)
))
# create sf point object from dataframe
#https://stackoverflow.com/questions/52551016/creating-sf-points-from-multiple-lat-longs
tree.sf <-  sf::st_as_sf(tree.coord.df, coords = c("lon", "lat"), remove = FALSE)
print(c(plot(my.inter$geometry, main = paste0(my.plot.id)),
plot(my.rem.circle$geometry, add = T),
plot(tree.sf$geometry, add = T))
)
#  # spatial
#   install.packages("sf")
#   install.packages("rgdal")
#   install.packages("terra")
#  install.packages("sfheaders")
install.packages("splancs")
library(splancs)
splancs::inout(tree.sf, my.rem.circle, bound = T)
tree.sf
splancs::inout(tree.coord.df, my.rem.circle, bound = T)
tree.coord.df
tree.coord.df$lon[1]
splancs::inout(as.data.frame(tree.coord.df$lon[1], tree.coord.df$lat[1]), my.rem.circle, bound = T)
as.data.frame(tree.coord.df$lon[1], tree.coord.df$lat[1]
as.data.frame(tree.coord.df$lon[1], tree.coord.df$lat[1])
as.data.frame(x = tree.east, y= tree.north)
as.data.frame(x = tree.east, y= tree.north)
as.data.frame(cbind(x = tree.east, y= tree.north))
splancs::inout(as.data.frame(cbind(x = tree.east, y= tree.north)), my.rem.circle, bound = T)
tree.pnt <- splancs::as.points(as.data.frame(cbind(x = tree.east, y= tree.north))
splancs::inout(), my.rem.circle, bound = T)
tree.pnt <- splancs::as.points(as.data.frame(cbind(x = tree.east, y= tree.north)))
tree.pnt
splancs::inout(tree.pnt, my.rem.circle, bound = T)
tree.pnt <- splancs::as.points(tree.east, tree.north)
tree.pnt
splancs::inout(tree.pnt, my.rem.circle, bound = T)
splancs::polymap(my.rem.circle)
splancs::polymap(my.rem.circle$geometry)
tree.pnt <- splancs::as.points(tree.east, tree.north)
print(plot(splancs::polymap(my.rem.circle$geometry)),
plot(splancs::pointmap(tree.sf$geometry)))
print(plot(splancs::polymap(my.rem.circle$geometry)),
plot(splancs::pointmap(tree.sf$geometry), add =T))
splancs::pointmap(tree.sf$geometry, add =T)
splancs::polymap(my.rem.circle$geometry)
splancs::pointmap(tree.sf$geometry, add =T)
splancs::pointmap(tree.sf$geometry)
tree.pnt
splancs::inout(tree.pnt, my.rem.circle$geometry, bound = T)
splancs::inout(tree.sf$geometry, my.rem.circle$geometry, bound = T)
tree.sf$geometry
as.points(tree.sf$geometry)
tree.pnt <- splancs::as.points(tree.east, tree.north)
tree.pnt
splancs::inout(tree.pnt, my.rem.circle$geometry, bound = T)
splancs::inout(splancs::as.points(tree.pnt), my.rem.circle$geometry, bound = T)
as.list(tree.pnt)
splancs::as.points(x = tree.east, y = tree.north)
splancs::as.points(cbind(x = tree.east, y = tree.north)))
splancs::as.points(cbind(x = tree.east, y = tree.north))
tree.pnt <- as.list(splancs::as.points(cbind(x = tree.east, y = tree.north)))
tree.pnt
tree.pnt <-splancs::as.points(cbind(x = tree.east, y = tree.north))
tree.pnt
splancs::inout(splancs::as.points(tree.pnt), my.rem.circle$geometry, bound = T)
tree.pnt <- as.list(splancs::as.points(cbind(x = tree.east, y = tree.north)))
splancs::inout(splancs::as.points(tree.pnt), my.rem.circle$geometry, bound = T)
splancs::as.points(tree.sf$geometry)
tree.sf$geometry
splancs::inout(tree.sf$geometry, my.rem.circle$geometry, bound = T)
rnorm(tree.east)
as.points(rnorm(100),rnorm(100))
# deadwood
# this dataset contains the data of the deadwood inventory of the HBI (BZE2), including info about species groups and B, C, N stocks per tree
DW_data <- read.delim(file = here(paste0(out.path.BZE3, trees_data$inv[1], "_DW_update_4.csv")), sep = ",", dec = ".")
DW_data
# 0.SETUP --------------------------------------------------------------------------------------------------------------------
# 0.1. packages and functions -------------------------------------------------------------------------------------------------
source(paste0(getwd(), "/scripts/01_00_functions_library.R"))
#  1.3. estabish connection to database --------------------------------------------------
con <- sqlconnection(db_name, db_server,db_port, db_user, my_db_password)
# names of the tables we want to import to our raw data folder:
code_table_names <- c("neu_x_ld", "neu_k_tangenz", "x_bart_neu")
data_table_names <- c("b2beab", "tit_1", "be", "beab", "be_waldraender", "bej", "bejb", "bedw", "bedw_liste", "punkt", "HBI_location")
# !!!!!!!!!!!!!! ENTER YOUR CREDENTIAL HERE !!!!!!!!!!!!!!!!!!!!!!!!!!
db_name <- "bze2"
db_server <- "134.110.100.88"
db_port <- "5432"
db_user <-  rstudioapi::askForPassword(prompt = "Please enter your username")
db_user <-  rstudioapi::askForPassword(prompt = "Please enter your username")
my_db_password <- rstudioapi::askForPassword(prompt = "Please enter your password")
#  1.3. estabish connection to database --------------------------------------------------
con <- sqlconnection(db_name, db_server,db_port, db_user, my_db_password)
# !!!!!!!!!!!!!! ENTER YOUR CREDENTIAL HERE !!!!!!!!!!!!!!!!!!!!!!!!!!
db_name <- "bze2"
db_server <- "134.110.100.88"
db_port <- "5432"
db_user <-  rstudioapi::askForPassword(prompt = "Please enter your username")
my_db_password <- rstudioapi::askForPassword(prompt = "Please enter your password")
# 0.SETUP --------------------------------------------------------------------------------------------------------------------
# 0.1. packages and functions -------------------------------------------------------------------------------------------------
source(paste0(getwd(), "/scripts/01_00_functions_library.R"))
#  1.3. estabish connection to database --------------------------------------------------
con <- sqlconnection(db_name, db_server,db_port, db_user, my_db_password)
con <- sqlconnection(db_name, db_server,db_port, db_user, my_db_password)
my.schema.name = "bze2_extern"
my.table.name = "vm_allgemeintab_2"
df <- dbGetQuery(con, paste0("SELECT * FROM"," ", my.schema.name,".", my.table.name))
df
# 0.2.3. import dataset ----------------------------------------------------------------
soil_types <- dbGetQuery(con, paste0("SELECT * FROM"," ", my.schema.name,".", my.table.name))
# 0.2.3. import dataset ----------------------------------------------------------------
soil_types_db <- dbGetQuery(con, paste0("SELECT * FROM"," ", my.schema.name,".", my.table.name))
soil_types_analysis <-  read.delim(file = here("data/input/paper/org_soil_types_BZE2.csv"), sep = ";", dec = ",")
soil_types_analysis
soil_types_analysis <-  read.delim(file = here("data/input/paper/org_soil_types_BZE2.csv"), sep = ",", dec = ".")
soil_types_analysis
soil_types_db
# 0.2.3. import dataset ----------------------------------------------------------------
soil_types_db <- dbGetQuery(con, paste0("SELECT * FROM"," ", my.schema.name,".", my.table.name)) %>%
mutate(plot_bodtyp = toupper(plot_bodtyp))
# 0.2.3. import dataset ----------------------------------------------------------------
soil_types_db <- dbGetQuery(con, paste0("SELECT * FROM"," ", my.schema.name,".", my.table.name)) %>%
mutate(bodentyp_2 = toupper(bodentyp_2))
soil_types_db
# 0.2.3. import dataset ----------------------------------------------------------------
soil_types_db <- dbGetQuery(con, paste0("SELECT * FROM"," ", my.schema.name,".", my.table.name)) %>%
mutate(bodentyp_2 = toupper(bodentyp_2))
soil_types_analysis <-  read.delim(file = here("data/input/paper/org_soil_types_BZE2.csv"), sep = ",", dec = ".")%>%
mutate(plot_bodtyp = toupper(plot_bodtyp))
org_soils_db <- soil_types_db %>% filter(bodentyp_2 %in% org_soil_types)
# 1. comparisson org soil types bd and analysis --------------------------------------------------------
org_soil_types <- c("GH", "GM", "GMg", "HH", "HN", "HN-SG", "KH", "KV", "KV-KM")
org_soils_db <- soil_types_db %>% filter(bodentyp_2 %in% org_soil_types)
org_soils_db
soil_types_analysis
org_soils_db <- soil_types_db %>% filter(bodentyp_2 %in% org_soil_types & erhebjahr_2 > 2000) %>% select(plot_ID, bodentyp_2, bodentypgr_2)
org_soils_db <- soil_types_db %>% filter(bodentyp_2 %in% org_soil_types & erhebjahr_2 > 2000) %>% select(bfhnr, bodentyp_2, bodentypgr_2)
soil_types_db
# 0.2.1. coencction details --------------------------------------------------
db_name <- "bze2"
db_server <- "134.110.100.88"
db_port <- "5432"
db_user <-  rstudioapi::askForPassword(prompt = "Please enter your username")
my_db_password <- rstudioapi::askForPassword(prompt = "Please enter your password")
my_db_password <- rstudioapi::askForPassword(prompt = "Please enter your password")
# 0.2.2. enable connection ----------------------------------------------------------
con <- sqlconnection(db_name, db_server,db_port, db_user, my_db_password)
# datasets name
my.schema.name = "bze2_extern"
my.table.name = "vm_allgemeintab_2"
# 0.2.3. import dataset ----------------------------------------------------------------
org_soil_types <- c("GH", "GM", "GMg", "HH", "HN", "HN-SG", "KH", "KV", "KV-KM")
# soil types database
soil_types_db <- dbGetQuery(con, paste0("SELECT * FROM"," ", my.schema.name,".", my.table.name)) %>%
mutate(bodentyp_2 = toupper(bodentyp_2))
# select only organic soil types from database dataset
org_soils_db <- soil_types_db %>% filter(bodentyp_2 %in% org_soil_types & erhebjahr_2 > 2000) %>% select(bfhnr_2, bodentyp_2, bodentypgr_2)
# soil types analysis
soil_types_analysis <-  read.delim(file = here("data/input/paper/org_soil_types_BZE2.csv"), sep = ",", dec = ".")%>%
mutate(plot_bodtyp = toupper(plot_bodtyp)) %>%
select(bfhnr, plot_bodtyp ) %>% distinct()
# select only organic soil types from database dataset
org_soils_db <- soil_types_db %>%
filter(bodentyp_2 %in% org_soil_types & erhebjahr_2 > 2000) %>%
select(bfhnr_2, bodentyp_2, bodentypgr_2) %>%
distinct()
org_soils_db
soil_types_analysis
anti_join(org_soils_db, soil_types_analysis, by = c("bfhnr" == "bfhnr_2") )
anti_join(org_soils_db, soil_types_analysis, by = ("bfhnr" == "bfhnr_2") )
anti_join(org_soils_db, soil_types_analysis, by = ("bfhnr" = "bfhnr_2") )
anti_join(org_soils_db, soil_types_analysis, by = ("bfhnr_2" = "bfhnr") )
soil_types_analysis
anti_join(org_soils_db, soil_types_analysis, by = ("bfhnr_2" == "bfhnr") )
anti_join(org_soils_db, soil_types_analysis, by = c("bfhnr_2" == "bfhnr") )
soil_types_db %>%
filter(bodentyp_2 %in% org_soil_types & erhebjahr_2 > 2000) %>%
select(bfhnr_2, bodentyp_2) %>%
rename("bfhnr" = "bfhnr_2")
# select only organic soil types from database dataset
org_soils_db <- soil_types_db %>%
filter(bodentyp_2 %in% org_soil_types & erhebjahr_2 > 2000) %>%
select(bfhnr_2, bodentyp_2) %>%
rename("bfhnr" = "bfhnr_2") %>%
distinct()
# soil types analysis
soil_types_analysis <-  read.delim(file = here("data/input/paper/org_soil_types_BZE2.csv"), sep = ",", dec = ".")%>%
mutate(plot_bodtyp = toupper(plot_bodtyp)) %>%
select(bfhnr, plot_bodtyp ) %>% distinct()
anti_join(org_soils_db, soil_types_analysis, by = "bfhnr" )
anti_join(soil_types_analysis, org_soils_db, by = "bfhnr" )
read.delim(file = here("data/input/paper/org_soil_types_BZE2.csv"), sep = ",", dec = ".")%>%
mutate(plot_bodtyp = toupper(plot_bodtyp)) %>%
filter(bodentyp_2 %in% org_soil_types)
# soil types analysis
soil_types_analysis <-  read.delim(file = here("data/input/paper/org_soil_types_BZE2.csv"), sep = ",", dec = ".")%>%
mutate(plot_bodtyp = toupper(plot_bodtyp)) %>%
filter(plot_bodtyp %in% org_soil_types) %>%
select(bfhnr, plot_bodtyp ) %>% distinct()
soil_types_analysis
# 0.2.3. import dataset ----------------------------------------------------------------
org_soil_types <- c("GH", "GM", "GMg", "HH", "HN", "HN-SG", "KH", "KV", "KV-KM")
# soil types database
soil_types_db <- dbGetQuery(con, paste0("SELECT * FROM"," ", my.schema.name,".", my.table.name)) %>%
mutate(bodentyp_2 = toupper(bodentyp_2))
# select only organic soil types from database dataset
org_soils_db <- soil_types_db %>%
filter(bodentyp_2 %in% org_soil_types & erhebjahr_2 > 2000) %>%
select(bfhnr_2, bodentyp_2) %>%
rename("bfhnr" = "bfhnr_2") %>%
distinct()
# soil types analysis
soil_types_analysis <-  read.delim(file = here("data/input/paper/org_soil_types_BZE2.csv"), sep = ",", dec = ".")%>%
mutate(plot_bodtyp = toupper(plot_bodtyp)) %>%
filter(plot_bodtyp %in% org_soil_types) %>%
select(bfhnr, plot_bodtyp ) %>% distinct()
# select only organic soil types from database dataset
org_soils_db <- soil_types_db %>% filter(bodentyp_2 %in% org_soil_types & erhebjahr_2 > 2000) %>% select(bfhnr_2, bodentyp_2, bodentypgr_2)
anti_join(org_soils_db, soil_types_analysis, by = "bfhnr" )
soil_types_analysis
org_soils_db
org_soils_db <- soil_types_db %>%
filter(bodentyp_2 %in% org_soil_types & erhebjahr_2 > 2000) %>%
select(bfhnr_2, bodentyp_2)
org_soils_db
rename
# select only organic soil types from database dataset
org_soils_db <- soil_types_db %>%
filter(bodentyp_2 %in% org_soil_types & erhebjahr_2 > 2000) %>%
select(bfhnr_2, bodentyp_2) %>%
rename(., bfhnr = bfhnr_2) %>%
distinct()
org_soils_db
# soil types analysis
soil_types_analysis <-  read.delim(file = here("data/input/paper/org_soil_types_BZE2.csv"), sep = ",", dec = ".")%>%
mutate(plot_bodtyp = toupper(plot_bodtyp)) %>%
filter(plot_bodtyp %in% org_soil_types) %>%
select(bfhnr, plot_bodtyp ) %>% distinct()
# select only organic soil types from database dataset
org_soils_db <- soil_types_db %>% filter(bodentyp_2 %in% org_soil_types & erhebjahr_2 > 2000) %>% select(bfhnr_2, bodentyp_2, bodentypgr_2)
# 0.SETUP --------------------------------------------------------------------------------------------------------------------
# 0.1. packages and functions -------------------------------------------------------------------------------------------------
source(paste0(getwd(), "/scripts/01_00_functions_library.R"))
# 0.2.1. coencction details --------------------------------------------------
db_name <- "bze2"
db_server <- "134.110.100.88"
db_port <- "5432"
db_user <-  rstudioapi::askForPassword(prompt = "Please enter your username")
my_db_password <- rstudioapi::askForPassword(prompt = "Please enter your password")
# 0.2.2. enable connection ----------------------------------------------------------
con <- sqlconnection(db_name, db_server,db_port, db_user, my_db_password)
# datasets name
my.schema.name = "bze2_extern"
my.table.name = "vm_allgemeintab_2"
# 0.2.3. import dataset ----------------------------------------------------------------
org_soil_types <- c("GH", "GM", "GMg", "HH", "HN", "HN-SG", "KH", "KV", "KV-KM")
# soil types database
soil_types_db <- dbGetQuery(con, paste0("SELECT * FROM"," ", my.schema.name,".", my.table.name)) %>%
mutate(bodentyp_2 = toupper(bodentyp_2))
# select only organic soil types from database dataset
org_soils_db <- soil_types_db %>%
filter(bodentyp_2 %in% org_soil_types & erhebjahr_2 > 2000) %>%
select(bfhnr_2, bodentyp_2) %>%
rename(., bfhnr = bfhnr_2) %>%
distinct()
# soil types analysis
soil_types_analysis <-  read.delim(file = here("data/input/paper/org_soil_types_BZE2.csv"), sep = ",", dec = ".")%>%
mutate(plot_bodtyp = toupper(plot_bodtyp)) %>%
filter(plot_bodtyp %in% org_soil_types) %>%
select(bfhnr, plot_bodtyp ) %>% distinct()
# 1. comparisson org soil types bd and analysis --------------------------------------------------------
anti_join(org_soils_db, soil_types_analysis, by = "bfhnr" )
anti_join(soil_types_analysis, org_soils_db, by = "bfhnr" )
nrow(org_soils_db)
nrow(soil_types_analysis)

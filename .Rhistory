N_all_com <- function(B, N_spec_w_rumpf, N_spec_f_BZE, N_spec_bg_Jacobsen, comp.trees){
n_con_w <- N_con_w  %>%  filter(compartiment != "ndl") %>% unite("SP_com", SP_BWI:compartiment, remove = FALSE)%>% dplyr::pull(N_con, SP_com);
n_con_f <- N_con_f %>% dplyr::pull(N_con, N_f_SP_group_MoMoK)
# this function may have to be be adapted to the new dataset of the NSI which provides accurate N cocntents for all species and foliage
# proably I will also have to assign new species groups to acces the foliage dataset correctly
n_con_bg <- c(EI = 3.71, BU = 3.03, FI = 4.14, KI = 1.77, KIN = 1.76, BI = 3.7, LA = 2.8)/1000;# divide concentration in mg per g by 1000 to get concentration in percent/ decimal number of percent
# unite the compartiment and species to select the correct nitrogen content
SP_compart_Rumpf <- paste0(N_spec_w_rumpf, "_", comp.trees);
# calculate nitrogen content in the aboveground and belowground compartiments but without sums (total or total aboveground N)
N <- case_when(
comp.trees == "ndl" ~ as.numeric(B)*as.numeric(n_con_f[N_spec_f_BZE]),
comp.trees == "bg" ~ as.numeric(B)*as.numeric(n_con_bg[N_spec_bg_Jacobsen]),
!(comp.trees %in% ("ag, total, ndl, bg")) ~ as.numeric(B)*as.numeric(n_con_w[SP_compart_Rumpf]),
TRUE ~ NA)
return(N)
}
# 1.13. carbon stock ------------------------------------------------------
carbon <- function(B){
C <- B*0.5;
return(C)
}
# Thuenen Institute - Bodenschutz und Waldzustand
# Analysis of the forest inventory accompanying the  national soil inventory
# stock calculations for regeneration
# working hours: out 14:30, in: 14:45, out: 17:00
# ----- 0. SETUP ---------------------------------------------------------------
# ----- 0.1. packages and functions --------------------------------------------
source(paste0(getwd(), "/scripts/00_functions_library.R"))
# ----- 0.2. working directory -------------------------------------------------
here::here()
getwd()
out.path.BZE3 <- ("output/out_data/out_data_BZE/")
# ----- 0.3 data import --------------------------------------------------------
# regeneration
# this dataset contains the plant specific inventory data of the regenertaion inventory of the HBI (BZE2), including stand and area info
HBI_RG <- read.delim(file = here("data/input/BZE2_HBI/bejb.csv"), sep = ",", dec = ",")%>% mutate(inv_year = 2012, inv = inv_name(inv_year))
#  "bund_nr"  "pk_nr"  "lfd_nr"   "bart"  "hoehe"    "grklasse"
colnames(HBI_RG) <- c("plot_ID", "CCS_no", "tree_ID", "SP_code", "H_cm", "D_class_cm", "inv_year", "inv")
# this dataset contains the position and extend of the sampling circle satelites of the regeneration inventory of the HBI (BZE2) including stand and area info
HBI_RG_loc <- read.delim(file = here(paste0(out.path.BZE3, "HBI_RG_loc_update_1.csv")), sep = ",", dec = ",")
# 1. calculations ---------------------------------------------------------
# 1.1. size class to diameter ---------------------------------------------
# translate size class into diameter
HBI_RG <- HBI_RG %>%
mutate(
D_cm = sizeclass_to_d(D_class_cm),
H_m = H_cm/100) %>%
# join in species names and codes from x_bart
left_join(., SP_names_com_ID_tapeS %>%
mutate(char_code_ger_lowcase = tolower(Chr_code_ger)),
by = c("SP_code" = "char_code_ger_lowcase"))
# 1.2 biomass -------------------------------------------------------------
# 1.2.1. biomass for RG trees height > 1.3m -------------------------------
# subset those trees that have a height above 1.3m and thus a DBH which allows them to be processed in TapeS
HBI.RG.above.1.3 <- HBI_RG[HBI_RG$H_m > 1.3, ]
# 1.2.1.1. aboveground biomass for RG trees height > 1.3m -------------------------------
# create output list
bio.ag.kg.RG.above.1.3 <- vector("list", length = nrow(HBI.RG.above.1.3))
for (i in 1:nrow(HBI.RG.above.1.3)) {
# i = 1
# basic tree info
# select one tree ID and plot ID for each individual tree per plot through unique(trees[, c("plot_ID", "tree_ID")])
my.plot.id <- HBI.RG.above.1.3[,"plot_ID"][i]
my.ccs.id <- HBI.RG.above.1.3[,"CCS_no"][i]
my.tree.id <- HBI.RG.above.1.3[,"tree_ID"][i]
BL.or.CF <- unique(HBI.RG.above.1.3$LH_NH[HBI.RG.above.1.3$plot_ID==my.plot.id & HBI.RG.above.1.3$tree_ID==my.tree.id & HBI.RG.above.1.3$CCS_no==my.ccs.id])
# select variales for tree object: tapes species, diameter, diameter measuring height, tree height
spp = na.omit(unique(HBI.RG.above.1.3$tpS_ID[HBI.RG.above.1.3$plot_ID==my.plot.id & HBI.RG.above.1.3$tree_ID==my.tree.id & HBI.RG.above.1.3$CCS_no==my.ccs.id]))
Dm = na.omit(as.list(as.numeric(unique(HBI.RG.above.1.3$D_cm[HBI.RG.above.1.3$plot_ID==my.plot.id & HBI.RG.above.1.3$tree_ID==my.tree.id & HBI.RG.above.1.3$CCS_no==my.ccs.id]))))
Hm = na.omit(as.list(as.numeric(1.3)))
Ht = na.omit(as.numeric(unique(HBI.RG.above.1.3$H_m[HBI.RG.above.1.3$plot_ID==my.plot.id & HBI.RG.above.1.3$tree_ID==my.tree.id & HBI.RG.above.1.3$CCS_no==my.ccs.id])))
# create tapes compartiments
comp <- as.character(c("stw","stb","sw", "sb", "fwb", "ndl" ))
# create object
obj.trees <- tprTrees(spp, Dm, Hm, Ht, inv = 4)
# calculate biomass per compartiment
bio.df <- as.data.frame(tprBiomass(obj = obj.trees, component = comp)) %>%
pivot_longer(cols = stw:ndl,
names_to = "compartiment",
values_to = "B_kg_tree")
bio.info.df <- as.data.frame(cbind(
"plot_ID" = c(as.integer(HBI.RG.above.1.3$plot_ID[HBI.RG.above.1.3$plot_ID == my.plot.id & HBI.RG.above.1.3$tree_ID == my.tree.id & HBI.RG.above.1.3$CCS_no==my.ccs.id])),
"tree_ID" = c(as.integer(HBI.RG.above.1.3$tree_ID[HBI.RG.above.1.3$plot_ID == my.plot.id & HBI.RG.above.1.3$tree_ID == my.tree.id & HBI.RG.above.1.3$CCS_no==my.ccs.id])),
"inv" = c(HBI.RG.above.1.3$inv[HBI.RG.above.1.3$plot_ID == my.plot.id & HBI.RG.above.1.3$tree_ID == my.tree.id & HBI.RG.above.1.3$CCS_no==my.ccs.id]),
"inv_year" = c(as.integer(HBI.RG.above.1.3$inv_year[HBI.RG.above.1.3$plot_ID == my.plot.id & HBI.RG.above.1.3$tree_ID == my.tree.id & HBI.RG.above.1.3$CCS_no==my.ccs.id])),
"LH_NH" = c(HBI.RG.above.1.3$LH_NH[HBI.RG.above.1.3$plot_ID == my.plot.id & HBI.RG.above.1.3$tree_ID == my.tree.id & HBI.RG.above.1.3$CCS_no==my.ccs.id]),
"compartiment" = c(bio.df$compartiment),
"B_kg_tree" = c(as.numeric(bio.df$B_kg_tree))
) ) %>%
# if the tree is a broadleafed tree Tapes cannot calculate the foliage mass,
# thus we calculate this subsequently trough the biomass function by Wutzler (2008)
mutate(B_kg_tree = ifelse(compartiment == "ndl" & LH_NH == "LB",
Wutzler_fB_L1(as.numeric(Dm), as.numeric(Ht)),
B_kg_tree)) %>%
dplyr::select(-c("LH_NH"))
bio.ag.kg.RG.above.1.3[[i]] <- bio.info.df
}
bio.ag.kg.RG.above.1.3.df <- as.data.frame(rbindlist(bio.ag.kg.RG.above.1.3))
# 1.2.1.1. aboveground biomass for RG trees height > 1.3m -------------------------------
bio.bg.kg.RG.above.1.3 <- vector("list", length = nrow(HBI.RG.above.1.3))
for (i in 1:nrow(HBI.RG.above.1.3)) {
# i = 1
# basic tree info
# select one tree ID and plot ID for each individual tree per plot and sampling circuit
my.plot.id <- HBI.RG.above.1.3[,"plot_ID"][i]
my.ccs.id <- HBI.RG.above.1.3[,"CCS_no"][i]
my.tree.id <- HBI.RG.above.1.3[,"tree_ID"][i]
BL.or.CF <- unique(HBI.RG.above.1.3$LH_NH[HBI.RG.above.1.3$plot_ID==my.plot.id & HBI.RG.above.1.3$tree_ID==my.tree.id & HBI.RG.above.1.3$CCS_no==my.ccs.id])
# select variales for belowground functions
spp = unique(HBI.RG.above.1.3$Bio_SP_group[HBI.RG.above.1.3$plot_ID==my.plot.id & HBI.RG.above.1.3$tree_ID==my.tree.id & HBI.RG.above.1.3$CCS_no==my.ccs.id])
dbh.cm = as.numeric(unique(HBI.RG.above.1.3$D_cm[HBI.RG.above.1.3$plot_ID==my.plot.id & HBI.RG.above.1.3$tree_ID==my.tree.id & HBI.RG.above.1.3$CCS_no==my.ccs.id]))
# calculate biomass per compartiment
B_kg_tree <- as.data.frame(GHGI_bB(spp, dbh.cm))[,1]
bio.info.df <- as.data.frame(cbind(
"plot_ID" = c(as.integer(my.plot.id)),
"tree_ID" = c(as.integer(my.tree.id)),
"inv" = unique(HBI.RG.above.1.3$inv[trees$plot_ID==my.plot.id & HBI.RG.above.1.3$tree_ID==my.tree.id]),
"inv_year" = c(as.integer(unique(HBI.RG.above.1.3$inv_year[HBI.RG.above.1.3$plot_ID==my.plot.id & HBI.RG.above.1.3$tree_ID==my.tree.id]))),
"compartiment" = c("bg"),
"B_kg_tree" = c(as.numeric(B_kg_tree))
) )
bio.bg.kg.RG.above.1.3[[i]] <- bio.info.df
}
bio.bg.kg.RG.above.1.3.df <- as.data.frame(rbindlist(bio.bg.kg.RG.above.1.3))
bio.bg.kg.RG.above.1.3.df
# 1.2.2. biomass for RG trees height < 1.3m -------------------------------
# subset those trees that have a height above 1.3m and thus a DBH which allows them to be processed in TapeS
HBI.RG.below.1.3 <- HBI_RG[HBI_RG$H_m < 1.3, ]
h.to.whd <- function(h, spec_wolff){
# the original function is as follows:
# h = a*whd^b
# now we have to transform it into wdh = ...
# the steps are:
# h/a = whd^b
# bth-root(h/a) = whd
a <- c(BAH = 4.3239, BI = 9.50205, BU= 4.8909,
VB = 6.2529, EI = 8.2332, ES =  3.4668, FKD = 10.26,  #in BWI: SLB; FKD = fauliger Kreuzdorn --> Faulbaum --> Rhamnus frangula
FI = 3.674, GIN = 12.322,  # Ginster = GIN
HOL =  5.5999,  # holunder
KI =  7.9661);
b <- c(BAH = 1.2531, BI = 1, BU = 1.1404, VB = 1.0844, EI = 1,
ES = 1.3483, FKD = 1.0269,  #in BWI: SLB; FKD = fauliger Kreuzdorn --> Faulbaum --> Rhamnus frangula
FI = 1.0905 , GIN = 1, # Ginster
HOL =  1.1832,
KI = 0.9366);
whd = nthroot((h/a[spec_wolff]), b[spec_wolff])
return(whd)
}
h.to.whd <- function(h, spec_wolff){
# the original function is as follows:
# h = a*whd^b
# now we have to transform it into wdh = ...
# the steps are:
# h/a = whd^b
# bth-root(h/a) = whd
# h is the trees height in cm
# whd is the radius at hte stem base (Wurzelhalsdurchmesser) in cm
a <- c(BAH = 4.3239, BI = 9.50205, BU= 4.8909,
VB = 6.2529, EI = 8.2332, ES =  3.4668, FKD = 10.26,  #in BWI: SLB; FKD = fauliger Kreuzdorn --> Faulbaum --> Rhamnus frangula
FI = 3.674, GIN = 12.322,  # Ginster = GIN
HOL =  5.5999,  # holunder
KI =  7.9661);
b <- c(BAH = 1.2531, BI = 1, BU = 1.1404, VB = 1.0844, EI = 1,
ES = 1.3483, FKD = 1.0269,  #in BWI: SLB; FKD = fauliger Kreuzdorn --> Faulbaum --> Rhamnus frangula
FI = 1.0905 , GIN = 1, # Ginster
HOL =  1.1832,
KI = 0.9366);
whd = nthroot((h/a[spec_wolff]), b[spec_wolff])
return(whd)
}
HBI.RG.below.1.3 %>% mutate(
WHD_cm = h.to.whd(H_cm, RG_Wolff_bio)
)
wolff.bio.below.1m <- function(whd, h, compartiment){
# parameters for total abovgroun biomass
a <- c(BAH = -4.116664, BI = -4.374745, BU= -5.329977,
VB = - 5.511373, EI = -6.890656, ES = -5.980901,
FKD = -5.805027, FI = -4.365029, GIN = -5.007328,
HOL = -5.596683, KI = -4.054296);
b <- c(BAH = 2.103417, BI = 1.952172, BU = 1.504128,
VB = 1.102974, EI = 0.992884, ES = 1.042600,
FKD = 1.268980, FI = 1.873336, GIN = 1.475571,
HOL = 1.133249, KI = 1.586179);
c  <- c(BAH = 0.499551, BI = 0.731565, BU = 1.182288,
VB = 1.326973, EI = 1.769866, ES = 1.519227,
FKD = 1.293988, FI = 0.977148, GIN = 1.069508,
HOL = 1.366231, KI = 0.911674);
# paremeters for branch + stem compartimen
d <- c(BAH = -5.255099, BI = 4.586260, BU = -6.160292,
VB = -6.050794, EI = -7.338351, ES = -6.623514,
FKD = -6.678752, FI = -5.295721, GIN = -5.329752,
HOL =  -6.697415, KI = -6.221465);
e <- c(BAH = 2.055909, BI = 2.317019, BU = 1.719560,
VB = 1.218037, EI = 1.100074, ES = 1.241859,
FKD = 1.709183, FI = 1.905118, GIN = 1.568195,
HOL = 1.685368, KI = 1.506163);
f <- c(BAH = 0.729275, BI = 0.495968, BU = 1.204329,
VB = 1.361229, EI = 1.739085, ES = 1.496878,
FKD = 1.231672, FI = 1.044837, GIN = 1.079322,
HOL = 1.207866, KI = 1.327712);
# paremeters for folliage compartiment
g <- c(BAH = -3.729638, BI =  -6.108247, BU = -5.385717,
VB = -7.216398, EI = -8.201379, ES = -6.584228,
FKD =  -5.943471, FI = -4.823170, GIN =  -6.240936,
HOL =  -4.956678, KI = -3.179742);
h <- c(BAH = 2.350116, BI = 1.369987, BU = 1.260222,
VB = 0.497185, EI = 0.900570, ES = 0.877136,
FKD = 0.875969, FI = 1.873277, GIN = 0.701319,
HOL = 0.486142, KI = 1.767087);
j <- c(BAH = -0.067977, BI = 1.175875, BU = 0.945780,
VB = 1.581494, EI = 1.833317, ES = 1.42240,
FKD = 1.193355, FI = 0.884113, GIN = 1.109381,
HOL = 1.248850, KI = 0.392809);
switch(
compartiment,
total = exp(a)*WHD^b*h^c,
stem = exp(d)*WHD^e*h^f,
foliage = exp(d)*WHD^e*h^f,
)
}
wolff.bio.below.1m
wolff.bio.below.1m <- function(whd, h, spec_wolff, compartiment){
# parameters for total abovgroun biomass
a <- c(BAH = -4.116664, BI = -4.374745, BU= -5.329977,
VB = - 5.511373, EI = -6.890656, ES = -5.980901,
FKD = -5.805027, FI = -4.365029, GIN = -5.007328,
HOL = -5.596683, KI = -4.054296);
b <- c(BAH = 2.103417, BI = 1.952172, BU = 1.504128,
VB = 1.102974, EI = 0.992884, ES = 1.042600,
FKD = 1.268980, FI = 1.873336, GIN = 1.475571,
HOL = 1.133249, KI = 1.586179);
c  <- c(BAH = 0.499551, BI = 0.731565, BU = 1.182288,
VB = 1.326973, EI = 1.769866, ES = 1.519227,
FKD = 1.293988, FI = 0.977148, GIN = 1.069508,
HOL = 1.366231, KI = 0.911674);
# paremeters for branch + stem compartimen
d <- c(BAH = -5.255099, BI = 4.586260, BU = -6.160292,
VB = -6.050794, EI = -7.338351, ES = -6.623514,
FKD = -6.678752, FI = -5.295721, GIN = -5.329752,
HOL =  -6.697415, KI = -6.221465);
e <- c(BAH = 2.055909, BI = 2.317019, BU = 1.719560,
VB = 1.218037, EI = 1.100074, ES = 1.241859,
FKD = 1.709183, FI = 1.905118, GIN = 1.568195,
HOL = 1.685368, KI = 1.506163);
f <- c(BAH = 0.729275, BI = 0.495968, BU = 1.204329,
VB = 1.361229, EI = 1.739085, ES = 1.496878,
FKD = 1.231672, FI = 1.044837, GIN = 1.079322,
HOL = 1.207866, KI = 1.327712);
# paremeters for folliage compartiment
x <- c(BAH = -3.729638, BI =  -6.108247, BU = -5.385717,
VB = -7.216398, EI = -8.201379, ES = -6.584228,
FKD =  -5.943471, FI = -4.823170, GIN =  -6.240936,
HOL =  -4.956678, KI = -3.179742);
y <- c(BAH = 2.350116, BI = 1.369987, BU = 1.260222,
VB = 0.497185, EI = 0.900570, ES = 0.877136,
FKD = 0.875969, FI = 1.873277, GIN = 0.701319,
HOL = 0.486142, KI = 1.767087);
z <- c(BAH = -0.067977, BI = 1.175875, BU = 0.945780,
VB = 1.581494, EI = 1.833317, ES = 1.42240,
FKD = 1.193355, FI = 0.884113, GIN = 1.109381,
HOL = 1.248850, KI = 0.392809);
switch(
compartiment,
total = exp(a[spec_wolff])*whd^b[spec_wolff]*h^c[spec_wolff],
stem = exp(d[spec_wolff])*whd^e[spec_wolff]*h^f[spec_wolff],
foliage = exp(x)*whd^y[spec_wolff]*h^z[spec_wolff]
)
}
HBI.RG.below.1.3 %>% mutate(
WHD_cm = h.to.whd(H_cm, RG_Wolff_bio),
bio_stem_kh = wolff.bio.below.1m(WHD_cm, H_cm, spec_wolff, compartiment = "stem")
)
HBI.RG.below.1.3 %>% mutate(
WHD_cm = h.to.whd(H_cm, RG_Wolff_bio),
bio_stem_kh = wolff.bio.below.1m(WHD_cm, H_cm, RG_Wolff_bio, compartiment = "stem")
)
# create tapes compartiments
comp <- as.character(c("sw+fw","ndl"))
wolff.bio.below.1m
wolff.bio.below.1m <- function(whd, h, spec_wolff, compartiment){
# parameters for total abovgroun biomass
a <- c(BAH = -4.116664, BI = -4.374745, BU= -5.329977,
VB = - 5.511373, EI = -6.890656, ES = -5.980901,
FKD = -5.805027, FI = -4.365029, GIN = -5.007328,
HOL = -5.596683, KI = -4.054296);
b <- c(BAH = 2.103417, BI = 1.952172, BU = 1.504128,
VB = 1.102974, EI = 0.992884, ES = 1.042600,
FKD = 1.268980, FI = 1.873336, GIN = 1.475571,
HOL = 1.133249, KI = 1.586179);
c  <- c(BAH = 0.499551, BI = 0.731565, BU = 1.182288,
VB = 1.326973, EI = 1.769866, ES = 1.519227,
FKD = 1.293988, FI = 0.977148, GIN = 1.069508,
HOL = 1.366231, KI = 0.911674);
# paremeters for branch + stem compartimen
d <- c(BAH = -5.255099, BI = 4.586260, BU = -6.160292,
VB = -6.050794, EI = -7.338351, ES = -6.623514,
FKD = -6.678752, FI = -5.295721, GIN = -5.329752,
HOL =  -6.697415, KI = -6.221465);
e <- c(BAH = 2.055909, BI = 2.317019, BU = 1.719560,
VB = 1.218037, EI = 1.100074, ES = 1.241859,
FKD = 1.709183, FI = 1.905118, GIN = 1.568195,
HOL = 1.685368, KI = 1.506163);
f <- c(BAH = 0.729275, BI = 0.495968, BU = 1.204329,
VB = 1.361229, EI = 1.739085, ES = 1.496878,
FKD = 1.231672, FI = 1.044837, GIN = 1.079322,
HOL = 1.207866, KI = 1.327712);
# paremeters for folliage compartiment
x <- c(BAH = -3.729638, BI =  -6.108247, BU = -5.385717,
VB = -7.216398, EI = -8.201379, ES = -6.584228,
FKD =  -5.943471, FI = -4.823170, GIN =  -6.240936,
HOL =  -4.956678, KI = -3.179742);
y <- c(BAH = 2.350116, BI = 1.369987, BU = 1.260222,
VB = 0.497185, EI = 0.900570, ES = 0.877136,
FKD = 0.875969, FI = 1.873277, GIN = 0.701319,
HOL = 0.486142, KI = 1.767087);
z <- c(BAH = -0.067977, BI = 1.175875, BU = 0.945780,
VB = 1.581494, EI = 1.833317, ES = 1.42240,
FKD = 1.193355, FI = 0.884113, GIN = 1.109381,
HOL = 1.248850, KI = 0.392809);
switch(
compartiment,
ag = exp(a[spec_wolff])*whd^b[spec_wolff]*h^c[spec_wolff],
stem = exp(d[spec_wolff])*whd^e[spec_wolff]*h^f[spec_wolff],
foliage = exp(x)*whd^y[spec_wolff]*h^z[spec_wolff]
)
}
my.plot.id <- HBI.RG.below.1.3[,"plot_ID"][i]
my.ccs.id <- HBI.RG.below.1.3[,"CCS_no"][i]
my.tree.id <- HBI.RG.below.1.3[,"tree_ID"][i]
BL.or.CF <- unique(HBI.RG.below.1.3$LH_NH[HBI.RG.below.1.3$plot_ID==my.plot.id & HBI.RG.below.1.3$tree_ID==my.tree.id & HBI.RG.below.1.3$CCS_no==my.ccs.id])
# select variales for belowground functions
spp = unique(HBI.RG.below.1.3$RG_Wolff_bio[HBI.RG.below.1.3$plot_ID==my.plot.id & HBI.RG.below.1.3$tree_ID==my.tree.id & HBI.RG.below.1.3$CCS_no==my.ccs.id])
h.cm = as.numeric(unique(HBI.RG.below.1.3$H_cm[HBI.RG.below.1.3$plot_ID==my.plot.id & HBI.RG.below.1.3$tree_ID==my.tree.id & HBI.RG.below.1.3$CCS_no==my.ccs.id]))
whd.cm = as.numeric(h.to.whd(h.cm, spp))
spp
h.cm
whd.cm
# calculate biomass per compartiment
B_kg_tree <- as.data.frame(cbind(
"compartiment" = c("sw+fw", "ndl", "ag"),
"B_kg_tree" = c(wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "stem"),
wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "foliage"),
wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "ag"))))
c(wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "stem"),
wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "foliage"),
wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "ag")
(wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "stem"),
wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "foliage"),
wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "ag"))
c(wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "stem"),
wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "foliage"),
wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "ag"))
c(wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "stem"),
wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "foliage"),
wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "ag"))
wolff.bio.below.1m <- function(whd, h, spec_wolff, compartiment){
# parameters for total abovgroun biomass
a <- c(BAH = -4.116664, BI = -4.374745, BU= -5.329977,
VB = - 5.511373, EI = -6.890656, ES = -5.980901,
FKD = -5.805027, FI = -4.365029, GIN = -5.007328,
HOL = -5.596683, KI = -4.054296);
b <- c(BAH = 2.103417, BI = 1.952172, BU = 1.504128,
VB = 1.102974, EI = 0.992884, ES = 1.042600,
FKD = 1.268980, FI = 1.873336, GIN = 1.475571,
HOL = 1.133249, KI = 1.586179);
c  <- c(BAH = 0.499551, BI = 0.731565, BU = 1.182288,
VB = 1.326973, EI = 1.769866, ES = 1.519227,
FKD = 1.293988, FI = 0.977148, GIN = 1.069508,
HOL = 1.366231, KI = 0.911674);
# paremeters for branch + stem compartimen
d <- c(BAH = -5.255099, BI = 4.586260, BU = -6.160292,
VB = -6.050794, EI = -7.338351, ES = -6.623514,
FKD = -6.678752, FI = -5.295721, GIN = -5.329752,
HOL =  -6.697415, KI = -6.221465);
e <- c(BAH = 2.055909, BI = 2.317019, BU = 1.719560,
VB = 1.218037, EI = 1.100074, ES = 1.241859,
FKD = 1.709183, FI = 1.905118, GIN = 1.568195,
HOL = 1.685368, KI = 1.506163);
f <- c(BAH = 0.729275, BI = 0.495968, BU = 1.204329,
VB = 1.361229, EI = 1.739085, ES = 1.496878,
FKD = 1.231672, FI = 1.044837, GIN = 1.079322,
HOL = 1.207866, KI = 1.327712);
# paremeters for folliage compartiment
x <- c(BAH = -3.729638, BI =  -6.108247, BU = -5.385717,
VB = -7.216398, EI = -8.201379, ES = -6.584228,
FKD =  -5.943471, FI = -4.823170, GIN =  -6.240936,
HOL =  -4.956678, KI = -3.179742);
y <- c(BAH = 2.350116, BI = 1.369987, BU = 1.260222,
VB = 0.497185, EI = 0.900570, ES = 0.877136,
FKD = 0.875969, FI = 1.873277, GIN = 0.701319,
HOL = 0.486142, KI = 1.767087);
z <- c(BAH = -0.067977, BI = 1.175875, BU = 0.945780,
VB = 1.581494, EI = 1.833317, ES = 1.42240,
FKD = 1.193355, FI = 0.884113, GIN = 1.109381,
HOL = 1.248850, KI = 0.392809);
switch(
compartiment,
"ag" = exp(a[spec_wolff])*whd^b[spec_wolff]*h^c[spec_wolff],
"stem" = exp(d[spec_wolff])*whd^e[spec_wolff]*h^f[spec_wolff],
"foliage" = exp(x)*whd^y[spec_wolff]*h^z[spec_wolff]
)
}
wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "stem")
wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "stem")[1]
z <- c(BAH = -0.067977, BI = 1.175875, BU = 0.945780,
VB = 1.581494, EI = 1.833317, ES = 1.42240,
FKD = 1.193355, FI = 0.884113, GIN = 1.109381,
HOL = 1.248850, KI = 0.392809);
wolff.bio.below.1m <- function(whd, h, spec_wolff, compartiment){
# parameters for total abovgroun biomass
a <- c(BAH = -4.116664, BI = -4.374745, BU= -5.329977,
VB = - 5.511373, EI = -6.890656, ES = -5.980901,
FKD = -5.805027, FI = -4.365029, GIN = -5.007328,
HOL = -5.596683, KI = -4.054296);
b <- c(BAH = 2.103417, BI = 1.952172, BU = 1.504128,
VB = 1.102974, EI = 0.992884, ES = 1.042600,
FKD = 1.268980, FI = 1.873336, GIN = 1.475571,
HOL = 1.133249, KI = 1.586179);
c  <- c(BAH = 0.499551, BI = 0.731565, BU = 1.182288,
VB = 1.326973, EI = 1.769866, ES = 1.519227,
FKD = 1.293988, FI = 0.977148, GIN = 1.069508,
HOL = 1.366231, KI = 0.911674);
# paremeters for branch + stem compartimen
d <- c(BAH = -5.255099, BI = 4.586260, BU = -6.160292,
VB = -6.050794, EI = -7.338351, ES = -6.623514,
FKD = -6.678752, FI = -5.295721, GIN = -5.329752,
HOL =  -6.697415, KI = -6.221465);
e <- c(BAH = 2.055909, BI = 2.317019, BU = 1.719560,
VB = 1.218037, EI = 1.100074, ES = 1.241859,
FKD = 1.709183, FI = 1.905118, GIN = 1.568195,
HOL = 1.685368, KI = 1.506163);
f <- c(BAH = 0.729275, BI = 0.495968, BU = 1.204329,
VB = 1.361229, EI = 1.739085, ES = 1.496878,
FKD = 1.231672, FI = 1.044837, GIN = 1.079322,
HOL = 1.207866, KI = 1.327712);
# paremeters for folliage compartiment
x <- c(BAH = -3.729638, BI =  -6.108247, BU = -5.385717,
VB = -7.216398, EI = -8.201379, ES = -6.584228,
FKD =  -5.943471, FI = -4.823170, GIN =  -6.240936,
HOL =  -4.956678, KI = -3.179742);
y <- c(BAH = 2.350116, BI = 1.369987, BU = 1.260222,
VB = 0.497185, EI = 0.900570, ES = 0.877136,
FKD = 0.875969, FI = 1.873277, GIN = 0.701319,
HOL = 0.486142, KI = 1.767087);
z <- c(BAH = -0.067977, BI = 1.175875, BU = 0.945780,
VB = 1.581494, EI = 1.833317, ES = 1.42240,
FKD = 1.193355, FI = 0.884113, GIN = 1.109381,
HOL = 1.248850, KI = 0.392809);
switch(
compartiment,
"ag" = exp(a[spec_wolff])*whd^b[spec_wolff]*h^c[spec_wolff],
"stem" = exp(d[spec_wolff])*whd^e[spec_wolff]*h^f[spec_wolff],
"foliage" = exp(x[spec_wolff])*whd^y[spec_wolff]*h^z[spec_wolff]
)
}
wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "stem")[1]
exp(a[spec_wolff])*whd^b[spec_wolff]*h^c[spec_wolff]
as.data.frame(wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "stem"))
as.data.frame(wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "stem"))[1,]
# calculate biomass per compartiment
B_kg_tree <- as.data.frame(cbind(
"compartiment" = c("sw+fw", "ndl", "ag"),
"B_kg_tree" = c(as.data.frame(wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "stem"))[1,],
as.data.frame(wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "foliage"))[1,],
as.data.frame(wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "ag"))[1,]
)))
B_kg_tree
bio.info.df <- as.data.frame(cbind(
"plot_ID" = c(as.integer(my.plot.id)),
"tree_ID" = c(as.integer(my.tree.id)),
"inv" = unique(HBI.RG.above.1.3$inv[trees$plot_ID==my.plot.id & HBI.RG.above.1.3$tree_ID==my.tree.id]),
"inv_year" = c(as.integer(unique(HBI.RG.above.1.3$inv_year[HBI.RG.above.1.3$plot_ID==my.plot.id & HBI.RG.above.1.3$tree_ID==my.tree.id]))),
"compartiment" = c(B_kg_tree$compartiment),
"B_kg_tree" = c(as.numeric(B_kg_tree$B_kg_tree))
)
)
bio.info.df
# 1.2.2. biomass for RG trees height < 1.3m -------------------------------
# subset those trees that have a height above 1.3m and thus a DBH which allows them to be processed in TapeS
HBI.RG.below.1.3 <- HBI_RG[HBI_RG$H_m < 1.3, ]
bio.ag.kg.RG.below.1.3 <- vector("list", length = nrow(HBI.RG.below.1.3))
for (i in 1:nrow(HBI.RG.below.1.3)) {
# i = 1
# basic tree info
# select one tree ID and plot ID for each individual tree per plot and sampling circuit
my.plot.id <- HBI.RG.below.1.3[,"plot_ID"][i]
my.ccs.id <- HBI.RG.below.1.3[,"CCS_no"][i]
my.tree.id <- HBI.RG.below.1.3[,"tree_ID"][i]
BL.or.CF <- unique(HBI.RG.below.1.3$LH_NH[HBI.RG.below.1.3$plot_ID==my.plot.id & HBI.RG.below.1.3$tree_ID==my.tree.id & HBI.RG.below.1.3$CCS_no==my.ccs.id])
# select variales for belowground functions
spp = unique(HBI.RG.below.1.3$RG_Wolff_bio[HBI.RG.below.1.3$plot_ID==my.plot.id & HBI.RG.below.1.3$tree_ID==my.tree.id & HBI.RG.below.1.3$CCS_no==my.ccs.id])
h.cm = as.numeric(unique(HBI.RG.below.1.3$H_cm[HBI.RG.below.1.3$plot_ID==my.plot.id & HBI.RG.below.1.3$tree_ID==my.tree.id & HBI.RG.below.1.3$CCS_no==my.ccs.id]))
whd.cm = as.numeric(h.to.whd(h.cm, spp))
# calculate biomass per compartiment
B_kg_tree <- as.data.frame(cbind(
"compartiment" = c("sw+fw", "ndl", "ag"),
"B_kg_tree" = c(as.data.frame(wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "stem"))[1,],
as.data.frame(wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "foliage"))[1,],
as.data.frame(wolff.bio.below.1m(whd.cm, h.cm, spp, compartiment = "ag"))[1,]
)))
bio.info.df <- as.data.frame(cbind(
"plot_ID" = c(as.integer(my.plot.id)),
"tree_ID" = c(as.integer(my.tree.id)),
"inv" = unique(HBI.RG.above.1.3$inv[trees$plot_ID==my.plot.id & HBI.RG.above.1.3$tree_ID==my.tree.id]),
"inv_year" = c(as.integer(unique(HBI.RG.above.1.3$inv_year[HBI.RG.above.1.3$plot_ID==my.plot.id & HBI.RG.above.1.3$tree_ID==my.tree.id]))),
"compartiment" = c(B_kg_tree$compartiment),
"B_kg_tree" = c(as.numeric(B_kg_tree$B_kg_tree))
)
)
bio.ag.kg.RG.below.1.3[[i]] <- bio.info.df
}
bio.ag.kg.RG.below.1.3.df <- as.data.frame(rbindlist(bio.ag.kg.RG.below.1.3))
